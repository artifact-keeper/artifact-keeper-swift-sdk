openapi: "3.1.0"
info:
  title: Artifact Keeper API
  version: "1.0.0-a2"
  description: >-
    REST API for Artifact Keeper, an open-source universal artifact registry.
    Covers user management, repositories, artifacts, search, security scanning,
    SBOM, dependency tracking, SSO, analytics, monitoring, telemetry, lifecycle
    policies, plugins, edge nodes, migration, and administration. Format-specific
    protocol endpoints (npm, PyPI, Maven, Docker/OCI, etc.) are not included;
    those follow their respective upstream specifications.
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
  contact:
    url: https://github.com/artifact-keeper/artifact-keeper

servers:
  - url: https://{domain}
    description: Production
    variables:
      domain:
        default: registry.example.com
  - url: http://localhost:8080
    description: Local development

security:
  - bearerAuth: []
  - apiKeyAuth: []

tags:
  - name: Health
    description: Service health and readiness probes
  - name: Auth
    description: Authentication and session management
  - name: Users
    description: User accounts, roles, and API tokens
  - name: Repositories
    description: Artifact repository management
  - name: Artifacts
    description: Individual artifact operations
  - name: Search
    description: Full-text and faceted search
  - name: Groups
    description: User group management
  - name: Permissions
    description: Access control and permission grants
  - name: Webhooks
    description: Event notification webhooks
  - name: Plugins
    description: WASM plugin lifecycle management
  - name: Formats
    description: Package format handler registry
  - name: Signing
    description: Artifact signing and verification
  - name: Security
    description: Vulnerability scanning and security policies
  - name: Edge Nodes
    description: Edge node management and content replication
  - name: Admin
    description: System administration and backups
  - name: Migration
    description: Registry migration from Artifactory/Nexus
  - name: Builds
    description: Build information tracking
  - name: Packages
    description: Package-level views across versions
  - name: Tree
    description: Repository file tree browsing
  - name: SBOM
    description: Software Bill of Materials generation and license compliance
  - name: Dependency Track
    description: Dependency-Track integration for vulnerability management
  - name: Analytics
    description: Storage analytics, download trends, and usage metrics
  - name: Monitoring
    description: Service health monitoring and alerting
  - name: Telemetry
    description: Crash reporting and telemetry settings
  - name: Lifecycle
    description: Artifact retention and cleanup policies
  - name: SSO Admin
    description: SSO provider configuration (OIDC, LDAP, SAML)
  - name: SSO
    description: SSO authentication flows

paths:
  /health:
    get:
      operationId: getHealth
      tags: [Health]
      summary: Health check
      description: Returns the health status of the service and its dependencies including database, storage, and scanner subsystems.
      security: []
      responses:
        "200":
          description: Service health status
          content:
            application/json:
              schema:
                type: object
                required: [status, database, storage, scanner]
                properties:
                  status:
                    type: string
                    enum: [healthy, degraded, unhealthy]
                    example: healthy
                  database:
                    $ref: "#/components/schemas/ComponentHealth"
                  storage:
                    $ref: "#/components/schemas/ComponentHealth"
                  scanner:
                    $ref: "#/components/schemas/ComponentHealth"
        "429":
          description: Too many requests
        "500":
          $ref: "#/components/responses/InternalServerError"

  /ready:
    get:
      operationId: getReadiness
      tags: [Health]
      summary: Readiness probe
      description: Returns whether the service is ready to accept traffic. Intended for use by container orchestrators and load balancers.
      security: []
      responses:
        "200":
          description: Readiness status
          content:
            application/json:
              schema:
                type: object
                required: [ready]
                properties:
                  ready:
                    type: boolean
                    example: true
        "429":
          description: Too many requests
        "500":
          $ref: "#/components/responses/InternalServerError"

  /metrics:
    get:
      operationId: getMetrics
      tags: [Health]
      summary: Prometheus metrics
      description: Returns Prometheus-formatted metrics for monitoring and alerting.
      security: []
      responses:
        "200":
          description: Prometheus metrics in text exposition format
          content:
            text/plain:
              schema:
                type: string
        "429":
          description: Too many requests
        "500":
          $ref: "#/components/responses/InternalServerError"

  # =============================================================================
  # Auth Endpoints
  # =============================================================================

  /api/v1/auth/login:
    post:
      operationId: login
      tags: [Auth]
      summary: Authenticate user
      description: Authenticates a user with username and password credentials and returns access and refresh tokens.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [username, password]
              properties:
                username:
                  type: string
                  minLength: 1
                  example: admin
                password:
                  type: string
                  format: password
                  minLength: 1
                  example: secret123
      responses:
        "200":
          description: Authentication successful
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TokenPair"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/auth/logout:
    post:
      operationId: logout
      tags: [Auth]
      summary: Logout user
      description: Invalidates the current session and associated tokens.
      responses:
        "204":
          description: Successfully logged out
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/auth/refresh:
    post:
      operationId: refreshToken
      tags: [Auth]
      summary: Refresh access token
      description: Exchanges a valid refresh token for a new access and refresh token pair.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [refresh_token]
              properties:
                refresh_token:
                  type: string
                  description: The refresh token obtained from login or a previous refresh call.
      responses:
        "200":
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TokenPair"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/auth/me:
    get:
      operationId: getCurrentUser
      tags: [Auth]
      summary: Get current user
      description: Returns the profile of the currently authenticated user.
      responses:
        "200":
          description: Current user profile
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  # =============================================================================
  # Users Endpoints
  # =============================================================================

  /api/v1/users:
    get:
      operationId: listUsers
      tags: [Users]
      summary: List users
      description: Returns a paginated list of users with optional filtering by search term and active status.
      parameters:
        - name: search
          in: query
          description: Filter users by username, email, or display name.
          schema:
            type: string
        - name: is_active
          in: query
          description: Filter by active status.
          schema:
            type: boolean
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/perPage"
      responses:
        "200":
          description: Paginated list of users
          content:
            application/json:
              schema:
                type: object
                required: [items, pagination]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/User"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/InternalServerError"

    post:
      operationId: createUser
      tags: [Users]
      summary: Create user
      description: Creates a new user account. Requires admin privileges.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [username, email, display_name, is_admin]
              properties:
                username:
                  type: string
                  minLength: 3
                  maxLength: 64
                  example: jdoe
                email:
                  type: string
                  format: email
                  example: jdoe@example.com
                password:
                  type: string
                  format: password
                  description: Optional. If omitted, a temporary password is generated.
                display_name:
                  type: string
                  maxLength: 128
                  example: Jane Doe
                is_admin:
                  type: boolean
                  default: false
      responses:
        "201":
          description: User created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/users/{id}:
    get:
      operationId: getUser
      tags: [Users]
      summary: Get user by ID
      description: Returns a single user by their unique identifier.
      parameters:
        - name: id
          in: path
          required: true
          description: User UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: User details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    patch:
      operationId: updateUser
      tags: [Users]
      summary: Update user
      description: Partially updates a user's profile. Requires admin privileges or ownership of the account.
      parameters:
        - name: id
          in: path
          required: true
          description: User UUID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                display_name:
                  type: string
                  maxLength: 128
                is_active:
                  type: boolean
                is_admin:
                  type: boolean
      responses:
        "200":
          description: User updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"

    delete:
      operationId: deleteUser
      tags: [Users]
      summary: Delete user
      description: Permanently deletes a user account. Requires admin privileges.
      parameters:
        - name: id
          in: path
          required: true
          description: User UUID
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: User deleted
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/users/{id}/roles:
    get:
      operationId: listUserRoles
      tags: [Users]
      summary: List user roles
      description: Returns all roles assigned to the specified user.
      parameters:
        - name: id
          in: path
          required: true
          description: User UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: List of roles
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Role"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    post:
      operationId: assignUserRole
      tags: [Users]
      summary: Assign role to user
      description: Assigns an existing role to the specified user. Requires admin privileges.
      parameters:
        - name: id
          in: path
          required: true
          description: User UUID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [role_id]
              properties:
                role_id:
                  type: string
                  format: uuid
      responses:
        "201":
          description: Role assigned
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/users/{id}/roles/{role_id}:
    delete:
      operationId: removeUserRole
      tags: [Users]
      summary: Remove role from user
      description: Removes a role assignment from the specified user. Requires admin privileges.
      parameters:
        - name: id
          in: path
          required: true
          description: User UUID
          schema:
            type: string
            format: uuid
        - name: role_id
          in: path
          required: true
          description: Role UUID
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: Role removed
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/users/{id}/tokens:
    get:
      operationId: listUserTokens
      tags: [Users]
      summary: List API tokens
      description: Returns all API tokens for the specified user. Token values are not included in the response.
      parameters:
        - name: id
          in: path
          required: true
          description: User UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: List of API tokens
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ApiToken"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    post:
      operationId: createUserToken
      tags: [Users]
      summary: Create API token
      description: >-
        Creates a new API token for the specified user. The token value is only
        returned in the creation response and cannot be retrieved afterwards.
      parameters:
        - name: id
          in: path
          required: true
          description: User UUID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name]
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 128
                  example: ci-deploy-token
                expires_at:
                  type: string
                  format: date-time
                  description: Token expiration timestamp. Omit for a non-expiring token.
                scopes:
                  type: array
                  items:
                    type: string
                  description: Optional list of permission scopes to restrict this token.
                  example: ["read:artifacts", "write:artifacts"]
      responses:
        "201":
          description: Token created
          content:
            application/json:
              schema:
                type: object
                required: [token, id, name, expires_at]
                properties:
                  token:
                    type: string
                    description: The plaintext token value. Store it securely; it cannot be retrieved again.
                  id:
                    type: string
                    format: uuid
                  name:
                    type: string
                  expires_at:
                    type: ["string", "null"]
                    format: date-time
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/users/{id}/tokens/{token_id}:
    delete:
      operationId: deleteUserToken
      tags: [Users]
      summary: Revoke API token
      description: Permanently revokes and deletes an API token.
      parameters:
        - name: id
          in: path
          required: true
          description: User UUID
          schema:
            type: string
            format: uuid
        - name: token_id
          in: path
          required: true
          description: Token UUID
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: Token revoked
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/users/{id}/password:
    post:
      operationId: changePassword
      tags: [Users]
      summary: Change password
      description: Changes the password for the specified user. Requires the current password for verification.
      parameters:
        - name: id
          in: path
          required: true
          description: User UUID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [current_password, new_password]
              properties:
                current_password:
                  type: string
                  format: password
                new_password:
                  type: string
                  format: password
                  minLength: 8
      responses:
        "204":
          description: Password changed
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/users/{id}/password/reset:
    post:
      operationId: resetPassword
      tags: [Users]
      summary: Reset user password
      description: Resets the user's password and returns a temporary password. Requires admin privileges.
      parameters:
        - name: id
          in: path
          required: true
          description: User UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Password reset
          content:
            application/json:
              schema:
                type: object
                required: [temporary_password]
                properties:
                  temporary_password:
                    type: string
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  # =============================================================================
  # Repositories Endpoints
  # =============================================================================

  /api/v1/repositories:
    get:
      operationId: listRepositories
      tags: [Repositories]
      summary: List repositories
      description: Returns a paginated list of repositories with optional filtering by package format, repository type, and search term.
      parameters:
        - name: format
          in: query
          description: Filter by package format (e.g. maven, npm, pypi, docker, generic).
          schema:
            type: string
        - name: type
          in: query
          description: Filter by repository type.
          schema:
            type: string
            enum: [local, remote, virtual]
        - name: search
          in: query
          description: Search repositories by key or name.
          schema:
            type: string
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/perPage"
      responses:
        "200":
          description: Paginated list of repositories
          content:
            application/json:
              schema:
                type: object
                required: [items, pagination]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/Repository"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

    post:
      operationId: createRepository
      tags: [Repositories]
      summary: Create repository
      description: Creates a new artifact repository. Requires admin privileges.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [key, name, format, type]
              properties:
                key:
                  type: string
                  pattern: "^[a-z0-9][a-z0-9._-]*$"
                  minLength: 2
                  maxLength: 64
                  example: libs-release-local
                name:
                  type: string
                  maxLength: 128
                  example: Release Libraries
                format:
                  type: string
                  enum: [maven, npm, pypi, docker, cargo, nuget, go, helm, generic]
                  example: maven
                type:
                  type: string
                  enum: [local, remote, virtual]
                  example: local
                description:
                  type: string
                  maxLength: 512
                is_public:
                  type: boolean
                  default: false
      responses:
        "201":
          description: Repository created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Repository"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/repositories/{key}:
    get:
      operationId: getRepository
      tags: [Repositories]
      summary: Get repository
      description: Returns detailed information about a single repository identified by its unique key.
      parameters:
        - name: key
          in: path
          required: true
          description: Repository key (unique identifier)
          schema:
            type: string
      responses:
        "200":
          description: Repository details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Repository"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    patch:
      operationId: updateRepository
      tags: [Repositories]
      summary: Update repository
      description: Partially updates repository metadata. Requires admin privileges.
      parameters:
        - name: key
          in: path
          required: true
          description: Repository key
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  maxLength: 128
                description:
                  type: string
                  maxLength: 512
                is_public:
                  type: boolean
                quota_bytes:
                  type: ["integer", "null"]
                  format: int64
                  description: Storage quota in bytes. Null for unlimited.
      responses:
        "200":
          description: Repository updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Repository"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    delete:
      operationId: deleteRepository
      tags: [Repositories]
      summary: Delete repository
      description: >-
        Deletes a repository. By default, fails if the repository contains
        artifacts. Use the force query parameter to delete a repository and
        all its contents.
      parameters:
        - name: key
          in: path
          required: true
          description: Repository key
          schema:
            type: string
        - name: force
          in: query
          description: Force deletion even if repository contains artifacts.
          schema:
            type: boolean
            default: false
      responses:
        "204":
          description: Repository deleted
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/repositories/{key}/artifacts:
    get:
      operationId: listRepositoryArtifacts
      tags: [Repositories]
      summary: List artifacts in repository
      description: Returns a paginated list of artifacts within the specified repository with optional path prefix filtering.
      parameters:
        - name: key
          in: path
          required: true
          description: Repository key
          schema:
            type: string
        - name: path_prefix
          in: query
          description: Filter artifacts whose path starts with this prefix.
          schema:
            type: string
        - name: search
          in: query
          description: Search within artifact names and paths.
          schema:
            type: string
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/perPage"
      responses:
        "200":
          description: Paginated list of artifacts
          content:
            application/json:
              schema:
                type: object
                required: [items, pagination]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/Artifact"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/repositories/{key}/artifacts/{path}:
    get:
      operationId: getRepositoryArtifact
      tags: [Repositories]
      summary: Get artifact info by path
      description: Returns metadata for a single artifact identified by its path within the repository. The path parameter is a catch-all that supports nested paths.
      parameters:
        - name: key
          in: path
          required: true
          description: Repository key
          schema:
            type: string
        - name: path
          in: path
          required: true
          description: Artifact path within the repository (catch-all, e.g. org/example/lib/1.0/lib-1.0.jar)
          schema:
            type: string
      responses:
        "200":
          description: Artifact metadata
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Artifact"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    put:
      operationId: uploadArtifact
      tags: [Repositories]
      summary: Upload artifact
      description: >-
        Uploads a binary artifact to the specified path within the repository.
        If an artifact already exists at the path it will be overwritten,
        creating a new version.
      parameters:
        - name: key
          in: path
          required: true
          description: Repository key
          schema:
            type: string
        - name: path
          in: path
          required: true
          description: Target path within the repository
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/octet-stream:
            schema:
              type: string
              format: binary
      responses:
        "201":
          description: Artifact uploaded
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Artifact"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    delete:
      operationId: deleteArtifact
      tags: [Repositories]
      summary: Delete artifact by path
      description: Permanently deletes the artifact at the specified path within the repository.
      parameters:
        - name: key
          in: path
          required: true
          description: Repository key
          schema:
            type: string
        - name: path
          in: path
          required: true
          description: Artifact path within the repository
          schema:
            type: string
      responses:
        "204":
          description: Artifact deleted
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/repositories/{key}/download/{path}:
    get:
      operationId: downloadArtifact
      tags: [Repositories]
      summary: Download artifact
      description: Downloads the binary content of an artifact. The response Content-Type is determined by the artifact's MIME type.
      parameters:
        - name: key
          in: path
          required: true
          description: Repository key
          schema:
            type: string
        - name: path
          in: path
          required: true
          description: Artifact path within the repository
          schema:
            type: string
      responses:
        "200":
          description: Artifact binary content
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  # =============================================================================
  # Artifacts (by ID) Endpoints
  # =============================================================================

  /api/v1/artifacts/{id}:
    get:
      operationId: getArtifact
      tags: [Artifacts]
      summary: Get artifact by ID
      description: Returns artifact metadata by its unique identifier. Optionally scope by repository key.
      parameters:
        - name: id
          in: path
          required: true
          description: Artifact UUID
          schema:
            type: string
            format: uuid
        - name: repository_key
          in: query
          description: Optional repository key to scope the lookup.
          schema:
            type: string
      responses:
        "200":
          description: Artifact metadata
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Artifact"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/artifacts/{id}/metadata:
    get:
      operationId: getArtifactMetadata
      tags: [Artifacts]
      summary: Get artifact metadata
      description: Returns format-specific metadata for the artifact (e.g. Maven POM info, npm package.json fields, Docker manifest data).
      parameters:
        - name: id
          in: path
          required: true
          description: Artifact UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Format-specific metadata
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
                description: Structure varies by artifact format.
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/artifacts/{id}/stats:
    get:
      operationId: getArtifactStats
      tags: [Artifacts]
      summary: Get artifact download stats
      description: Returns download statistics for the specified artifact.
      parameters:
        - name: id
          in: path
          required: true
          description: Artifact UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Download statistics
          content:
            application/json:
              schema:
                type: object
                required: [total_downloads, downloads_30d, last_downloaded_at]
                properties:
                  total_downloads:
                    type: integer
                    format: int64
                    example: 15432
                  downloads_30d:
                    type: integer
                    format: int64
                    example: 982
                  last_downloaded_at:
                    type: ["string", "null"]
                    format: date-time
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  # =============================================================================
  # Search Endpoints
  # =============================================================================

  /api/v1/search/quick:
    get:
      operationId: quickSearch
      tags: [Search]
      summary: Quick search
      description: Performs a fast full-text search across all accessible artifacts. Suitable for search-as-you-type interfaces.
      parameters:
        - name: q
          in: query
          required: true
          description: Search query string.
          schema:
            type: string
            minLength: 1
        - name: limit
          in: query
          description: Maximum number of results to return.
          schema:
            type: integer
            default: 10
            minimum: 1
            maximum: 100
      responses:
        "200":
          description: Search results
          content:
            application/json:
              schema:
                type: object
                required: [results]
                properties:
                  results:
                    type: array
                    items:
                      $ref: "#/components/schemas/SearchResult"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/search/advanced:
    get:
      operationId: advancedSearch
      tags: [Search]
      summary: Advanced search
      description: Performs a faceted search with filtering, sorting, and pagination support.
      parameters:
        - name: q
          in: query
          required: true
          description: Search query string.
          schema:
            type: string
            minLength: 1
        - name: format
          in: query
          description: Filter by package format.
          schema:
            type: string
        - name: repository
          in: query
          description: Filter by repository key.
          schema:
            type: string
        - name: sort
          in: query
          description: Sort field.
          schema:
            type: string
            enum: [relevance, name, created_at, size, downloads]
            default: relevance
        - name: order
          in: query
          description: Sort order.
          schema:
            type: string
            enum: [asc, desc]
            default: desc
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/perPage"
      responses:
        "200":
          description: Search results with facets
          content:
            application/json:
              schema:
                type: object
                required: [items, facets, pagination]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/SearchResult"
                  facets:
                    type: object
                    additionalProperties:
                      type: array
                      items:
                        type: object
                        required: [value, count]
                        properties:
                          value:
                            type: string
                          count:
                            type: integer
                    description: Aggregated facets (e.g. format counts, repository counts).
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/search/checksum:
    get:
      operationId: searchByChecksum
      tags: [Search]
      summary: Search by checksum
      description: Finds artifacts matching a given checksum. Provide at least one of sha256, sha1, or md5.
      parameters:
        - name: sha256
          in: query
          description: SHA-256 hex digest
          schema:
            type: string
            pattern: "^[a-f0-9]{64}$"
        - name: sha1
          in: query
          description: SHA-1 hex digest
          schema:
            type: string
            pattern: "^[a-f0-9]{40}$"
        - name: md5
          in: query
          description: MD5 hex digest
          schema:
            type: string
            pattern: "^[a-f0-9]{32}$"
      responses:
        "200":
          description: Matching artifacts
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Artifact"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/search/suggest:
    get:
      operationId: searchSuggestions
      tags: [Search]
      summary: Autocomplete suggestions
      description: Returns search term suggestions based on a prefix. Useful for typeahead/autocomplete in the UI.
      parameters:
        - name: prefix
          in: query
          required: true
          description: The prefix to generate suggestions for.
          schema:
            type: string
            minLength: 1
      responses:
        "200":
          description: Suggestions
          content:
            application/json:
              schema:
                type: object
                required: [suggestions]
                properties:
                  suggestions:
                    type: array
                    items:
                      type: string
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/search/trending:
    get:
      operationId: getTrendingArtifacts
      tags: [Search]
      summary: Trending artifacts
      description: Returns the most downloaded artifacts over a given time window.
      parameters:
        - name: days
          in: query
          description: Number of days to look back for trending calculation.
          schema:
            type: integer
            default: 7
            minimum: 1
            maximum: 90
      responses:
        "200":
          description: Trending artifacts
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Artifact"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/search/recent:
    get:
      operationId: getRecentArtifacts
      tags: [Search]
      summary: Recently uploaded artifacts
      description: Returns the most recently uploaded artifacts across all accessible repositories.
      parameters:
        - name: limit
          in: query
          description: Maximum number of results to return.
          schema:
            type: integer
            default: 10
            minimum: 1
            maximum: 100
      responses:
        "200":
          description: Recent artifacts
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Artifact"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  # =============================================================================
  # Groups Endpoints
  # =============================================================================

  /api/v1/groups:
    get:
      operationId: listGroups
      tags: [Groups]
      summary: List groups
      description: Returns all groups visible to the authenticated user.
      responses:
        "200":
          description: List of groups
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Group"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

    post:
      operationId: createGroup
      tags: [Groups]
      summary: Create group
      description: Creates a new group. Requires admin privileges.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name]
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 128
                  example: backend-team
                description:
                  type: string
                  maxLength: 512
      responses:
        "201":
          description: Group created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Group"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/groups/{id}:
    get:
      operationId: getGroup
      tags: [Groups]
      summary: Get group
      description: Returns a single group by its unique identifier, including its members.
      parameters:
        - name: id
          in: path
          required: true
          description: Group UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Group details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Group"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    patch:
      operationId: updateGroup
      tags: [Groups]
      summary: Update group
      description: Partially updates group metadata. Requires admin privileges.
      parameters:
        - name: id
          in: path
          required: true
          description: Group UUID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 128
                description:
                  type: string
                  maxLength: 512
      responses:
        "200":
          description: Group updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Group"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"

    delete:
      operationId: deleteGroup
      tags: [Groups]
      summary: Delete group
      description: Permanently deletes a group and removes all associated permission grants. Requires admin privileges.
      parameters:
        - name: id
          in: path
          required: true
          description: Group UUID
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: Group deleted
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/groups/{id}/members:
    post:
      operationId: addGroupMembers
      tags: [Groups]
      summary: Add members to group
      description: Adds one or more users to the group. Users who are already members are silently ignored.
      parameters:
        - name: id
          in: path
          required: true
          description: Group UUID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/GroupMembersRequest"
      responses:
        "204":
          description: Members added
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    delete:
      operationId: removeGroupMembers
      tags: [Groups]
      summary: Remove members from group
      description: Removes one or more users from the group. Users who are not members are silently ignored.
      parameters:
        - name: id
          in: path
          required: true
          description: Group UUID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/GroupMembersRequest"
      responses:
        "204":
          description: Members removed
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  # =============================================================================
  # Permissions Endpoints
  # =============================================================================

  /api/v1/permissions:
    get:
      operationId: listPermissions
      tags: [Permissions]
      summary: List permissions
      description: Returns all permission grants. Requires admin privileges.
      responses:
        "200":
          description: List of permissions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Permission"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/InternalServerError"

    post:
      operationId: createPermission
      tags: [Permissions]
      summary: Create permission
      description: >-
        Creates a new permission grant associating a principal (user or group)
        with allowed actions on a resource. Requires admin privileges.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, resource_type, actions, principal_type, principal_id]
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 128
                  example: backend-team-libs-release
                resource_type:
                  type: string
                  enum: [repository, system]
                  example: repository
                resource_id:
                  type: ["string", "null"]
                  format: uuid
                  description: The resource to grant access to. Required when resource_type is system-wide.
                actions:
                  type: array
                  items:
                    type: string
                    enum: [read, write, delete, admin]
                  minItems: 1
                  example: [read, write]
                principal_type:
                  type: string
                  enum: [user, group]
                  example: group
                principal_id:
                  type: string
                  format: uuid
      responses:
        "201":
          description: Permission created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Permission"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/permissions/{id}:
    get:
      operationId: getPermission
      tags: [Permissions]
      summary: Get permission
      description: Returns a single permission grant by its unique identifier.
      parameters:
        - name: id
          in: path
          required: true
          description: Permission UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Permission details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Permission"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    patch:
      operationId: updatePermission
      tags: [Permissions]
      summary: Update permission
      description: Updates the allowed actions on an existing permission grant. Requires admin privileges.
      parameters:
        - name: id
          in: path
          required: true
          description: Permission UUID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                actions:
                  type: array
                  items:
                    type: string
                    enum: [read, write, delete, admin]
                  minItems: 1
      responses:
        "200":
          description: Permission updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Permission"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    delete:
      operationId: deletePermission
      tags: [Permissions]
      summary: Delete permission
      description: Permanently removes a permission grant. Requires admin privileges.
      parameters:
        - name: id
          in: path
          required: true
          description: Permission UUID
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: Permission deleted
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"


  /api/v1/webhooks:
    get:
      operationId: listWebhooks
      tags: [Webhooks]
      summary: List webhooks
      description: Returns a paginated list of configured webhooks.
      parameters:
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/perPage"
      responses:
        "200":
          description: Paginated list of webhooks
          content:
            application/json:
              schema:
                type: object
                required: [items, pagination]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/Webhook"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

    post:
      operationId: createWebhook
      tags: [Webhooks]
      summary: Create webhook
      description: Creates a new webhook subscription for the specified events.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [url, events, is_enabled]
              properties:
                url:
                  type: string
                  format: uri
                  example: https://ci.example.com/hooks/artifact-keeper
                events:
                  type: array
                  items:
                    type: string
                  minItems: 1
                  example: [artifact_uploaded, artifact_deleted]
                repository_id:
                  type: string
                  format: uuid
                  description: Optional. Scope the webhook to a specific repository.
                is_enabled:
                  type: boolean
                  default: true
                secret:
                  type: string
                  description: Optional shared secret used to sign delivery payloads.
      responses:
        "201":
          description: Webhook created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Webhook"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/webhooks/{id}:
    get:
      operationId: getWebhook
      tags: [Webhooks]
      summary: Get webhook
      description: Returns a single webhook by its unique identifier.
      parameters:
        - name: id
          in: path
          required: true
          description: Webhook UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Webhook details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Webhook"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    delete:
      operationId: deleteWebhook
      tags: [Webhooks]
      summary: Delete webhook
      description: Permanently deletes a webhook and all its delivery history.
      parameters:
        - name: id
          in: path
          required: true
          description: Webhook UUID
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: Webhook deleted
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    patch:
      operationId: updateWebhook
      tags: [Webhooks]
      summary: Update webhook
      description: Partially updates an existing webhook configuration.
      parameters:
        - name: id
          in: path
          required: true
          description: Webhook UUID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                url:
                  type: string
                  format: uri
                events:
                  type: array
                  items:
                    type: string
                repository_id:
                  type: ["string", "null"]
                  format: uuid
                is_enabled:
                  type: boolean
                secret:
                  type: string
      responses:
        "200":
          description: Webhook updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Webhook"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/webhooks/{id}/enable:
    parameters:
      - name: id
        in: path
        required: true
        description: Webhook ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: enableWebhook
      tags: [Webhooks]
      summary: Enable a webhook
      description: Activates a previously disabled webhook so it resumes receiving deliveries.
      responses:
        "200":
          description: Webhook enabled.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Webhook"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/webhooks/{id}/disable:
    parameters:
      - name: id
        in: path
        required: true
        description: Webhook ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: disableWebhook
      tags: [Webhooks]
      summary: Disable a webhook
      description: Suspends a webhook so it no longer receives deliveries until re-enabled.
      responses:
        "200":
          description: Webhook disabled.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Webhook"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/webhooks/{id}/test:
    post:
      operationId: testWebhook
      tags: [Webhooks]
      summary: Test webhook
      description: Sends a test ping event to the webhook URL to verify connectivity and configuration.
      parameters:
        - name: id
          in: path
          required: true
          description: Webhook UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Test delivery result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WebhookDelivery"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/webhooks/{id}/deliveries:
    get:
      operationId: listWebhookDeliveries
      tags: [Webhooks]
      summary: List webhook deliveries
      description: Returns a paginated list of delivery attempts for the specified webhook.
      parameters:
        - name: id
          in: path
          required: true
          description: Webhook UUID
          schema:
            type: string
            format: uuid
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/perPage"
      responses:
        "200":
          description: Paginated list of deliveries
          content:
            application/json:
              schema:
                type: object
                required: [items, pagination]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/WebhookDelivery"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/webhooks/{id}/deliveries/{delivery_id}/redeliver:
    post:
      operationId: redeliverWebhook
      tags: [Webhooks]
      summary: Redeliver webhook
      description: Retries a previously failed webhook delivery using the original payload.
      parameters:
        - name: id
          in: path
          required: true
          description: Webhook UUID
          schema:
            type: string
            format: uuid
        - name: delivery_id
          in: path
          required: true
          description: Delivery UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Redelivery result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WebhookDelivery"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  # =============================================================================
  # Plugins Endpoints
  # =============================================================================

  /api/v1/plugins:
    get:
      operationId: listPlugins
      tags: [Plugins]
      summary: List plugins
      description: Returns a paginated list of installed plugins.
      parameters:
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/perPage"
      responses:
        "200":
          description: Paginated list of plugins
          content:
            application/json:
              schema:
                type: object
                required: [items, pagination]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/Plugin"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

    post:
      operationId: uploadPlugin
      tags: [Plugins]
      summary: Upload a plugin
      description: Uploads and installs a plugin from a multipart form submission containing the WASM binary and metadata.
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file]
              properties:
                file:
                  type: string
                  format: binary
                  description: The plugin WASM binary.
                name:
                  type: string
                  description: Human-readable plugin name.
                description:
                  type: string
                  description: Plugin description.
      responses:
        "201":
          description: Plugin installed.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Plugin"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "422":
          $ref: "#/components/responses/UnprocessableEntity"

  /api/v1/plugins/{id}:
    get:
      operationId: getPlugin
      tags: [Plugins]
      summary: Get plugin
      description: Returns detailed information about a single installed plugin.
      parameters:
        - name: id
          in: path
          required: true
          description: Plugin UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Plugin details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Plugin"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    delete:
      operationId: uninstallPlugin
      tags: [Plugins]
      summary: Uninstall plugin
      description: Uninstalls a plugin and removes its WASM binary and configuration.
      parameters:
        - name: id
          in: path
          required: true
          description: Plugin UUID
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: Plugin uninstalled
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    patch:
      operationId: updatePlugin
      tags: [Plugins]
      summary: Update plugin
      description: Updates plugin status (activate or disable).
      parameters:
        - name: id
          in: path
          required: true
          description: Plugin UUID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  enum: [active, disabled]
      responses:
        "200":
          description: Plugin updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Plugin"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/plugins/{id}/enable:
    parameters:
      - name: id
        in: path
        required: true
        description: Plugin ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: enablePlugin
      tags: [Plugins]
      summary: Enable a plugin
      description: Activates a disabled plugin so it begins processing events.
      responses:
        "200":
          description: Plugin enabled.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Plugin"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/plugins/{id}/disable:
    parameters:
      - name: id
        in: path
        required: true
        description: Plugin ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: disablePlugin
      tags: [Plugins]
      summary: Disable a plugin
      description: Deactivates a plugin so it stops processing events until re-enabled.
      responses:
        "200":
          description: Plugin disabled.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Plugin"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/plugins/{id}/config:
    get:
      operationId: getPluginConfig
      tags: [Plugins]
      summary: Get plugin config
      description: Returns the current configuration for the specified plugin.
      parameters:
        - name: id
          in: path
          required: true
          description: Plugin UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Plugin configuration
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
                description: Plugin-specific configuration key-value pairs.
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    put:
      operationId: updatePluginConfig
      tags: [Plugins]
      summary: Update plugin config
      description: Replaces the entire plugin configuration with the provided JSON object.
      parameters:
        - name: id
          in: path
          required: true
          description: Plugin UUID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: true
              description: Arbitrary JSON configuration for the plugin.
      responses:
        "200":
          description: Plugin configuration updated
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/plugins/{id}/events:
    get:
      operationId: listPluginEvents
      tags: [Plugins]
      summary: List plugin events
      description: Returns a paginated list of events emitted by the specified plugin.
      parameters:
        - name: id
          in: path
          required: true
          description: Plugin UUID
          schema:
            type: string
            format: uuid
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/perPage"
      responses:
        "200":
          description: Paginated list of plugin events
          content:
            application/json:
              schema:
                type: object
                required: [items, pagination]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/PluginEvent"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/plugins/install/git:
    post:
      operationId: installPluginFromGit
      tags: [Plugins]
      summary: Install plugin from Git
      description: Installs a WASM plugin by cloning from a Git repository URL.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [url]
              properties:
                url:
                  type: string
                  format: uri
                  example: https://github.com/example/artifact-plugin.git
                branch:
                  type: string
                  description: Optional branch to clone. Defaults to the repository default branch.
                  example: main
      responses:
        "201":
          description: Plugin installed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Plugin"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/plugins/install/zip:
    post:
      operationId: installPluginFromZip
      tags: [Plugins]
      summary: Install plugin from ZIP
      description: Installs a WASM plugin by uploading a ZIP archive containing the plugin bundle.
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file]
              properties:
                file:
                  type: string
                  format: binary
                  description: ZIP archive containing the plugin bundle.
      responses:
        "201":
          description: Plugin installed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Plugin"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/plugins/install/local:
    post:
      operationId: installPluginFromLocal
      tags: [Plugins]
      summary: Install plugin from local path
      description: Installs a WASM plugin from a local filesystem path accessible to the server.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [path]
              properties:
                path:
                  type: string
                  description: Absolute filesystem path to the plugin directory or WASM file.
                  example: /opt/plugins/custom-format
      responses:
        "201":
          description: Plugin installed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Plugin"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/plugins/{id}/reload:
    parameters:
      - name: id
        in: path
        required: true
        description: Plugin ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: reloadPlugin
      tags: [Plugins]
      summary: Reload a plugin
      description: Hot-reloads a plugin, re-reading its WASM binary and configuration without a full restart.
      responses:
        "200":
          description: Plugin reloaded.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Plugin"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  # 
  # 11. Formats
  # 
  /api/v1/formats:
    get:
      operationId: listFormats
      tags: [Formats]
      summary: List format handlers
      description: Returns all registered format handlers including both core and WASM-based handlers.
      responses:
        "200":
          description: List of format handlers
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/FormatHandler"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/formats/{format_key}:
    get:
      operationId: getFormat
      tags: [Formats]
      summary: Get format handler
      description: Returns detailed information about a single format handler identified by its unique key.
      parameters:
        - name: format_key
          in: path
          required: true
          description: Format handler key (e.g. maven, npm, docker)
          schema:
            type: string
      responses:
        "200":
          description: Format handler details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FormatHandler"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/formats/{format_key}/enable:
    post:
      operationId: enableFormat
      tags: [Formats]
      summary: Enable format handler
      description: Enables a previously disabled format handler, allowing repositories of this format to accept uploads.
      parameters:
        - name: format_key
          in: path
          required: true
          description: Format handler key
          schema:
            type: string
      responses:
        "200":
          description: Format handler enabled
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FormatHandler"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/formats/{format_key}/disable:
    post:
      operationId: disableFormat
      tags: [Formats]
      summary: Disable format handler
      description: Disables a format handler. Existing artifacts remain accessible but new uploads are rejected.
      parameters:
        - name: format_key
          in: path
          required: true
          description: Format handler key
          schema:
            type: string
      responses:
        "200":
          description: Format handler disabled
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FormatHandler"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/formats/{format_key}/test:
    post:
      operationId: testFormat
      tags: [Formats]
      summary: Test format handler
      description: Tests the format handler with sample data to verify it is functioning correctly.
      parameters:
        - name: format_key
          in: path
          required: true
          description: Format handler key
          schema:
            type: string
      responses:
        "200":
          description: Test result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TestResultResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  # =============================================================================
  # Signing Endpoints
  # =============================================================================

  /api/v1/signing/keys:
    get:
      operationId: listSigningKeys
      tags: [Signing]
      summary: List signing keys
      description: Returns a paginated list of signing keys.
      parameters:
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/perPage"
      responses:
        "200":
          description: Paginated list of signing keys
          content:
            application/json:
              schema:
                type: object
                required: [items, pagination]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/SigningKey"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

    post:
      operationId: createSigningKey
      tags: [Signing]
      summary: Create signing key
      description: Generates a new signing key pair for artifact signing.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, key_type]
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 128
                  example: release-signing-key
                key_type:
                  type: string
                  enum: [rsa, gpg]
                  example: rsa
                repository_id:
                  type: string
                  format: uuid
                  description: Optional. Scope the key to a specific repository.
      responses:
        "201":
          description: Signing key created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SigningKey"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/signing/keys/{key_id}:
    parameters:
      - name: key_id
        in: path
        required: true
        description: Signing key ID.
        schema:
          type: string
          format: uuid

    get:
      operationId: getSigningKey
      tags: [Signing]
      summary: Get a signing key
      description: Returns details of a single signing key.
      responses:
        "200":
          description: Signing key details.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SigningKey"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

    delete:
      operationId: deleteSigningKey
      tags: [Signing]
      summary: Delete a signing key
      description: Permanently removes a signing key. Active repositories using this key must be reconfigured first.
      responses:
        "204":
          description: Signing key deleted.
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"

  /api/v1/signing/keys/{key_id}/revoke:
    parameters:
      - name: key_id
        in: path
        required: true
        description: Signing key ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: revokeSigningKey
      tags: [Signing]
      summary: Revoke a signing key
      description: Marks a signing key as revoked so it can no longer be used for signing operations.
      responses:
        "200":
          description: Signing key revoked.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SigningKey"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/signing/keys/{key_id}/rotate:
    parameters:
      - name: key_id
        in: path
        required: true
        description: Signing key ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: rotateSigningKey
      tags: [Signing]
      summary: Rotate a signing key
      description: Generates a new key pair, replaces the existing key, and revokes the old one.
      responses:
        "200":
          description: Signing key rotated.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SigningKey"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/signing/keys/{key_id}/public:
    parameters:
      - name: key_id
        in: path
        required: true
        description: Signing key ID.
        schema:
          type: string
          format: uuid
    get:
      operationId: getSigningKeyPublic
      tags: [Signing]
      summary: Get public key material
      description: Returns the public key in PEM (RSA) or ASCII-armored (GPG) format.
      responses:
        "200":
          description: Public key in text format.
          content:
            text/plain:
              schema:
                type: string
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/signing/repositories/{repo_id}/config:
    parameters:
      - name: repo_id
        in: path
        required: true
        description: Repository ID.
        schema:
          type: string
          format: uuid

    get:
      operationId: getRepositorySigningConfig
      tags: [Signing]
      summary: Get repository signing configuration
      description: Returns the signing configuration for a repository.
      responses:
        "200":
          description: Signing configuration.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SigningRepositoryConfig"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

    post:
      operationId: updateRepositorySigningConfig
      tags: [Signing]
      summary: Update repository signing configuration
      description: Updates signing settings for a repository, such as which key to use and what to sign.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SigningRepositoryConfig"
      responses:
        "200":
          description: Updated signing configuration.
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/signing/repositories/{repo_id}/public-key:
    parameters:
      - name: repo_id
        in: path
        required: true
        description: Repository ID.
        schema:
          type: string
          format: uuid
    get:
      operationId: getRepositoryPublicKey
      tags: [Signing]
      summary: Get repository public key
      description: Returns the active public signing key for a repository in PEM or GPG armored format.
      responses:
        "200":
          description: Public key in text format.
          content:
            text/plain:
              schema:
                type: string
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  # 
  # 13. Security
  # 
  /api/v1/security/dashboard:
    get:
      operationId: getSecurityDashboard
      tags: [Security]
      summary: Get security dashboard
      description: Returns an overview of security scan statistics and overall health score.
      responses:
        "200":
          description: Security dashboard summary.
          content:
            application/json:
              schema:
                type: object
                required: [total_scans, critical_findings, high_findings, repositories_scanned, overall_score]
                properties:
                  total_scans:
                    type: integer
                  critical_findings:
                    type: integer
                  high_findings:
                    type: integer
                  repositories_scanned:
                    type: integer
                  overall_score:
                    type: number
                    format: float
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/v1/security/scores:
    get:
      operationId: listSecurityScores
      tags: [Security]
      summary: List security scores
      description: Returns security scores for all repositories.
      responses:
        "200":
          description: List of repository security scores
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/SecurityScore"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/security/scan:
    post:
      operationId: triggerSecurityScan
      tags: [Security]
      summary: Trigger a security scan
      description: Initiates an asynchronous security scan for a specific artifact, repository, or using a named scanner.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                artifact_id:
                  type: string
                  format: uuid
                  description: Scan a specific artifact.
                repository_id:
                  type: string
                  format: uuid
                  description: Scan all artifacts in a repository.
                scanner:
                  type: string
                  description: Name of the scanner plugin to use.
      responses:
        "202":
          description: Scan initiated.
          content:
            application/json:
              schema:
                type: object
                required: [scan_id]
                properties:
                  scan_id:
                    type: string
                    format: uuid
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "422":
          $ref: "#/components/responses/UnprocessableEntity"

  /api/v1/security/scans:
    get:
      operationId: listScans
      tags: [Security]
      summary: List security scans
      description: Returns a paginated list of security scans with optional filtering by status and repository.
      parameters:
        - name: status
          in: query
          description: Filter by scan status.
          schema:
            type: string
            enum: [pending, running, completed, failed]
        - name: repository_id
          in: query
          description: Filter by repository UUID.
          schema:
            type: string
            format: uuid
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/perPage"
      responses:
        "200":
          description: Paginated list of scans
          content:
            application/json:
              schema:
                type: object
                required: [items, pagination]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/Scan"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

    post:
      operationId: triggerScan
      tags: [Security]
      summary: Trigger security scan
      description: Triggers a new security scan for the specified artifact or repository.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [scanner]
              properties:
                artifact_id:
                  type: string
                  format: uuid
                  description: Scan a specific artifact.
                repository_id:
                  type: string
                  format: uuid
                  description: Scan all artifacts in a repository.
                scanner:
                  type: string
                  enum: [trivy, grype]
                  example: trivy
      responses:
        "201":
          description: Scan triggered
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Scan"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/security/scans/{id}:
    get:
      operationId: getScan
      tags: [Security]
      summary: Get scan details
      description: Returns detailed information about a single security scan.
      parameters:
        - name: id
          in: path
          required: true
          description: Scan UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Scan details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Scan"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/security/scans/{id}/findings:
    get:
      operationId: listScanFindings
      tags: [Security]
      summary: List scan findings
      description: Returns a paginated list of vulnerability findings for a specific scan with optional severity filtering.
      parameters:
        - name: id
          in: path
          required: true
          description: Scan UUID
          schema:
            type: string
            format: uuid
        - name: severity
          in: query
          description: Filter by vulnerability severity.
          schema:
            type: string
            enum: [critical, high, medium, low, negligible]
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/perPage"
      responses:
        "200":
          description: Paginated list of findings
          content:
            application/json:
              schema:
                type: object
                required: [items, pagination]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/Finding"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/security/artifacts/{artifact_id}/scans:
    parameters:
      - name: artifact_id
        in: path
        required: true
        description: Artifact ID.
        schema:
          type: string
          format: uuid
    get:
      operationId: listArtifactScans
      tags: [Security]
      summary: List scans for an artifact
      description: Returns all security scans that have been performed on a specific artifact.
      responses:
        "200":
          description: List of scans for the artifact.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Scan"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/security/findings/{id}/acknowledge:
    post:
      operationId: acknowledgeFinding
      tags: [Security]
      summary: Acknowledge finding
      description: Marks a vulnerability finding as acknowledged with an explanatory reason.
      parameters:
        - name: id
          in: path
          required: true
          description: Finding UUID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [reason]
              properties:
                reason:
                  type: string
                  minLength: 1
                  example: Mitigated by network policy; no public exposure.
      responses:
        "200":
          description: Finding acknowledged
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Finding"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    delete:
      operationId: unacknowledgeFinding
      tags: [Security]
      summary: Remove finding acknowledgement
      description: Removes the acknowledgement from a previously acknowledged finding.
      parameters:
        - name: id
          in: path
          required: true
          description: Finding UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Acknowledgement removed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Finding"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/security/policies:
    get:
      operationId: listSecurityPolicies
      tags: [Security]
      summary: List security policies
      description: Returns all configured security policies.
      responses:
        "200":
          description: List of security policies
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/SecurityPolicy"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

    post:
      operationId: createSecurityPolicy
      tags: [Security]
      summary: Create security policy
      description: Creates a new security policy with rules for vulnerability handling.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, rules, is_enabled]
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 128
                  example: block-critical-vulns
                rules:
                  type: object
                  description: "Policy rules, e.g. { block_severity: [\"critical\"], quarantine_severity: [\"high\"] }"
                repository_id:
                  type: string
                  format: uuid
                  description: Optional. Scope the policy to a specific repository.
                is_enabled:
                  type: boolean
                  default: true
      responses:
        "201":
          description: Security policy created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SecurityPolicy"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/security/policies/{id}:
    get:
      operationId: getSecurityPolicy
      tags: [Security]
      summary: Get security policy
      description: Returns a single security policy by its unique identifier.
      parameters:
        - name: id
          in: path
          required: true
          description: Security policy UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Security policy details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SecurityPolicy"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    put:
      operationId: updateSecurityPolicy
      tags: [Security]
      summary: Update a security policy
      description: Replaces a security policy with the provided definition.
      parameters:
        - name: id
          in: path
          required: true
          description: Security policy UUID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SecurityPolicy"
      responses:
        "200":
          description: Security policy updated.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SecurityPolicy"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "422":
          $ref: "#/components/responses/UnprocessableEntity"

    delete:
      operationId: deleteSecurityPolicy
      tags: [Security]
      summary: Delete security policy
      description: Permanently deletes a security policy.
      parameters:
        - name: id
          in: path
          required: true
          description: Security policy UUID
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: Security policy deleted
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/edge-nodes:
    get:
      operationId: listEdgeNodes
      tags: [Edge Nodes]
      summary: List edge nodes
      description: Returns all registered edge nodes.
      responses:
        "200":
          description: List of edge nodes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/EdgeNode"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

    post:
      operationId: registerEdgeNode
      tags: [Edge Nodes]
      summary: Register edge node
      description: Registers a new edge node in the CDN mesh network.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, region, url, capacity_mb, repositories]
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 128
                  example: edge-us-west-1
                region:
                  type: string
                  example: us-west-2
                url:
                  type: string
                  format: uri
                  example: https://edge-usw1.example.com
                capacity_mb:
                  type: integer
                  minimum: 1
                  example: 102400
                repositories:
                  type: array
                  items:
                    type: string
                  description: Repository keys to assign to this edge node.
                  example: [libs-release-local, docker-local]
      responses:
        "201":
          description: Edge node registered
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EdgeNode"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/edge-nodes/{id}:
    get:
      operationId: getEdgeNode
      tags: [Edge Nodes]
      summary: Get edge node
      description: Returns detailed information about a single edge node.
      parameters:
        - name: id
          in: path
          required: true
          description: Edge node UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Edge node details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EdgeNode"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    delete:
      operationId: deregisterEdgeNode
      tags: [Edge Nodes]
      summary: Deregister edge node
      description: Deregisters an edge node, removing it from the CDN mesh network.
      parameters:
        - name: id
          in: path
          required: true
          description: Edge node UUID
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: Edge node deregistered
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    patch:
      operationId: updateEdgeNode
      tags: [Edge Nodes]
      summary: Update edge node
      description: Partially updates edge node configuration.
      parameters:
        - name: id
          in: path
          required: true
          description: Edge node UUID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  maxLength: 128
                region:
                  type: string
                url:
                  type: string
                  format: uri
                capacity_mb:
                  type: integer
                  minimum: 1
      responses:
        "200":
          description: Edge node updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EdgeNode"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/edge-nodes/{id}/heartbeat:
    post:
      operationId: edgeNodeHeartbeat
      tags: [Edge Nodes]
      summary: Edge node heartbeat
      description: Reports the current status and cache usage of an edge node. Called periodically by edge node agents.
      parameters:
        - name: id
          in: path
          required: true
          description: Edge node UUID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [status, cache_size_mb]
              properties:
                status:
                  type: string
                  enum: [healthy, degraded, offline]
                cache_size_mb:
                  type: integer
                  minimum: 0
      responses:
        "204":
          description: Heartbeat acknowledged
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/edge-nodes/{id}/sync:
    post:
      operationId: triggerEdgeNodeSync
      tags: [Edge Nodes]
      summary: Trigger sync
      description: Triggers a content sync for the specified edge node by artifact ID or repository key.
      parameters:
        - name: id
          in: path
          required: true
          description: Edge node UUID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                artifact_id:
                  type: string
                  format: uuid
                  description: Sync a specific artifact.
                repository_key:
                  type: string
                  description: Sync all artifacts in a repository.
      responses:
        "201":
          description: Sync task created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SyncTask"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/edge-nodes/{id}/sync/tasks:
    parameters:
      - name: id
        in: path
        required: true
        description: Edge node ID.
        schema:
          type: string
          format: uuid
    get:
      operationId: listEdgeNodeSyncTasks
      tags: [Edge Nodes]
      summary: List sync tasks
      description: Returns all synchronization tasks for an edge node.
      responses:
        "200":
          description: List of sync tasks.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/SyncTask"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/edge-nodes/{id}/repositories/{repo_id}:
    parameters:
      - name: id
        in: path
        required: true
        description: Edge node ID.
        schema:
          type: string
          format: uuid
      - name: repo_id
        in: path
        required: true
        description: Repository ID.
        schema:
          type: string
          format: uuid

    post:
      operationId: assignRepositoryToEdgeNode
      tags: [Edge Nodes]
      summary: Assign a repository to an edge node
      description: Configures an edge node to cache and serve artifacts from the specified repository.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [priority]
              properties:
                priority:
                  type: integer
                  description: Sync priority for this repository on the node.
      responses:
        "201":
          description: Repository assigned to edge node.
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

    delete:
      operationId: removeRepositoryFromEdgeNode
      tags: [Edge Nodes]
      summary: Remove a repository from an edge node
      description: Stops the edge node from caching the specified repository and purges its cached artifacts.
      responses:
        "204":
          description: Repository removed from edge node.
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/edge-nodes/{id}/transfer/init:
    parameters:
      - name: id
        in: path
        required: true
        description: Edge node ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: initTransferSession
      tags: [Edge Nodes]
      summary: Initiate a transfer session
      description: Creates a new chunked transfer session to distribute an artifact to or between edge nodes.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [artifact_id]
              properties:
                artifact_id:
                  type: string
                  format: uuid
                  description: Artifact to transfer.
                target_node_id:
                  type: string
                  format: uuid
                  description: Optional target edge node for node-to-node transfer.
      responses:
        "201":
          description: Transfer session created.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransferSession"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/edge-nodes/{id}/transfer/{session_id}:
    parameters:
      - name: id
        in: path
        required: true
        description: Edge node ID.
        schema:
          type: string
          format: uuid
      - name: session_id
        in: path
        required: true
        description: Transfer session ID.
        schema:
          type: string
          format: uuid
    get:
      operationId: getTransferSession
      tags: [Edge Nodes]
      summary: Get transfer session status
      description: Returns the current status and progress of a transfer session.
      responses:
        "200":
          description: Transfer session details.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransferSession"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/edge-nodes/{id}/transfer/{session_id}/chunks:
    parameters:
      - name: id
        in: path
        required: true
        description: Edge node ID.
        schema:
          type: string
          format: uuid
      - name: session_id
        in: path
        required: true
        description: Transfer session ID.
        schema:
          type: string
          format: uuid
    get:
      operationId: getTransferChunkManifest
      tags: [Edge Nodes]
      summary: Get chunk manifest
      description: Returns the chunk manifest for a transfer session including sizes and checksums.
      responses:
        "200":
          description: Chunk manifest.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ChunkManifest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/edge-nodes/{id}/transfer/{session_id}/chunk/{chunk_index}:
    parameters:
      - name: id
        in: path
        required: true
        description: Edge node ID.
        schema:
          type: string
          format: uuid
      - name: session_id
        in: path
        required: true
        description: Transfer session ID.
        schema:
          type: string
          format: uuid
      - name: chunk_index
        in: path
        required: true
        description: Zero-based chunk index.
        schema:
          type: integer
    post:
      operationId: uploadTransferChunk
      tags: [Edge Nodes]
      summary: Upload a transfer chunk
      description: Uploads a single binary chunk for a transfer session.
      requestBody:
        required: true
        content:
          application/octet-stream:
            schema:
              type: string
              format: binary
      responses:
        "200":
          description: Chunk uploaded.
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/edge-nodes/{id}/transfer/{session_id}/chunk/{chunk_index}/fail:
    parameters:
      - name: id
        in: path
        required: true
        description: Edge node ID.
        schema:
          type: string
          format: uuid
      - name: session_id
        in: path
        required: true
        description: Transfer session ID.
        schema:
          type: string
          format: uuid
      - name: chunk_index
        in: path
        required: true
        description: Zero-based chunk index.
        schema:
          type: integer
    post:
      operationId: failTransferChunk
      tags: [Edge Nodes]
      summary: Mark a chunk as failed
      description: Reports that a chunk transfer has failed, allowing the coordinator to take corrective action.
      responses:
        "200":
          description: Chunk marked as failed.
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/edge-nodes/{id}/transfer/{session_id}/chunk/{chunk_index}/retry:
    parameters:
      - name: id
        in: path
        required: true
        description: Edge node ID.
        schema:
          type: string
          format: uuid
      - name: session_id
        in: path
        required: true
        description: Transfer session ID.
        schema:
          type: string
          format: uuid
      - name: chunk_index
        in: path
        required: true
        description: Zero-based chunk index.
        schema:
          type: integer
    post:
      operationId: retryTransferChunk
      tags: [Edge Nodes]
      summary: Retry a failed chunk
      description: Requests a retry of a previously failed chunk transfer.
      responses:
        "200":
          description: Chunk retry initiated.
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/edge-nodes/{id}/transfer/{session_id}/complete:
    parameters:
      - name: id
        in: path
        required: true
        description: Edge node ID.
        schema:
          type: string
          format: uuid
      - name: session_id
        in: path
        required: true
        description: Transfer session ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: completeTransferSession
      tags: [Edge Nodes]
      summary: Complete a transfer session
      description: Finalizes a transfer session after all chunks have been uploaded and verified.
      responses:
        "200":
          description: Transfer session completed.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransferSession"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/edge-nodes/{id}/transfer/{session_id}/fail:
    parameters:
      - name: id
        in: path
        required: true
        description: Edge node ID.
        schema:
          type: string
          format: uuid
      - name: session_id
        in: path
        required: true
        description: Transfer session ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: failTransferSession
      tags: [Edge Nodes]
      summary: Fail a transfer session
      description: Marks an entire transfer session as failed, releasing resources.
      responses:
        "200":
          description: Transfer session marked as failed.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransferSession"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/edge-nodes/{id}/peers:
    get:
      operationId: listEdgeNodePeers
      tags: [Edge Nodes]
      summary: List peer connections
      description: Returns all peer connections for the specified edge node.
      parameters:
        - name: id
          in: path
          required: true
          description: Edge node UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: List of peer connections
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/PeerConnection"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    post:
      operationId: addEdgeNodePeer
      tags: [Edge Nodes]
      summary: Add peer connection
      description: Establishes a peer connection between two edge nodes for P2P content distribution.
      parameters:
        - name: id
          in: path
          required: true
          description: Edge node UUID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [peer_node_id]
              properties:
                peer_node_id:
                  type: string
                  format: uuid
      responses:
        "201":
          description: Peer connection created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PeerConnection"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/edge-nodes/{id}/peers/discover:
    parameters:
      - name: id
        in: path
        required: true
        description: Edge node ID.
        schema:
          type: string
          format: uuid
    get:
      operationId: discoverEdgeNodePeers
      tags: [Edge Nodes]
      summary: Discover peers
      description: Triggers peer discovery and returns newly found peer connections.
      responses:
        "200":
          description: Discovered peer connections.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/PeerConnection"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/edge-nodes/{id}/peers/probe:
    parameters:
      - name: id
        in: path
        required: true
        description: Edge node ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: probeEdgeNodePeers
      tags: [Edge Nodes]
      summary: Probe peer connectivity
      description: Tests network connectivity from this edge node to its peers and returns reachability and latency.
      responses:
        "200":
          description: Probe result.
          content:
            application/json:
              schema:
                type: object
                required: [reachable, latency_ms]
                properties:
                  reachable:
                    type: boolean
                  latency_ms:
                    type: number
                    format: float
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/edge-nodes/{id}/peers/{targetId}/unreachable:
    parameters:
      - name: id
        in: path
        required: true
        description: Edge node ID.
        schema:
          type: string
          format: uuid
      - name: targetId
        in: path
        required: true
        description: Target peer node ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: reportPeerUnreachable
      tags: [Edge Nodes]
      summary: Report a peer as unreachable
      description: Reports that a specific peer node is unreachable from this edge node, updating the network topology.
      responses:
        "200":
          description: Peer marked as unreachable.
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/edge-nodes/{id}/chunks/{artifact_id}:
    parameters:
      - name: id
        in: path
        required: true
        description: Edge node ID.
        schema:
          type: string
          format: uuid
      - name: artifact_id
        in: path
        required: true
        description: Artifact ID.
        schema:
          type: string
          format: uuid
    get:
      operationId: listArtifactChunks
      tags: [Edge Nodes]
      summary: List artifact chunks on an edge node
      description: Returns the list of chunks for a specific artifact that are cached on this edge node.
      responses:
        "200":
          description: List of chunks.
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  required:
                    - index
                    - offset
                    - size
                    - sha256
                    - status
                  properties:
                    index:
                      type: integer
                    offset:
                      type: integer
                    size:
                      type: integer
                    sha256:
                      type: string
                    status:
                      type: string
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/edge-nodes/{id}/chunks/{artifact_id}/peers:
    parameters:
      - name: id
        in: path
        required: true
        description: Edge node ID.
        schema:
          type: string
          format: uuid
      - name: artifact_id
        in: path
        required: true
        description: Artifact ID.
        schema:
          type: string
          format: uuid
    get:
      operationId: listArtifactChunkPeers
      tags: [Edge Nodes]
      summary: List peers holding artifact chunks
      description: Returns peers that have chunks of the specified artifact available for transfer.
      responses:
        "200":
          description: List of peer connections holding artifact chunks.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/PeerConnection"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/edge-nodes/{id}/chunks/{artifact_id}/scored-peers:
    parameters:
      - name: id
        in: path
        required: true
        description: Edge node ID.
        schema:
          type: string
          format: uuid
      - name: artifact_id
        in: path
        required: true
        description: Artifact ID.
        schema:
          type: string
          format: uuid
    get:
      operationId: listArtifactScoredPeers
      tags: [Edge Nodes]
      summary: List scored peers for artifact chunks
      description: Returns peers holding artifact chunks ranked by a composite score of latency, bandwidth, and reliability.
      responses:
        "200":
          description: Scored peer list.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ScoredPeer"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/edge-nodes/network-profile:
    put:
      operationId: updateNetworkProfile
      tags: [Edge Nodes]
      summary: Update the network profile
      description: Replaces the global network profile that governs edge node communication parameters.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NetworkProfile"
      responses:
        "200":
          description: Network profile updated.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NetworkProfile"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "422":
          $ref: "#/components/responses/UnprocessableEntity"

  # 
  # 15. Admin
  # 
  /api/v1/admin/backups:
    get:
      operationId: listBackups
      tags: [Admin]
      summary: List backups
      description: Returns a paginated list of system backups.
      parameters:
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/perPage"
      responses:
        "200":
          description: Paginated list of backups
          content:
            application/json:
              schema:
                type: object
                required: [items, pagination]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/Backup"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/InternalServerError"

    post:
      operationId: createBackup
      tags: [Admin]
      summary: Create backup
      description: Initiates a new system backup with the specified options.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [type, include_artifacts]
              properties:
                type:
                  type: string
                  enum: [full, metadata, incremental]
                  example: full
                include_artifacts:
                  type: boolean
                  description: Whether to include artifact binary data in the backup.
                  default: false
      responses:
        "201":
          description: Backup created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Backup"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/admin/backups/{id}:
    get:
      operationId: getBackup
      tags: [Admin]
      summary: Get backup details
      description: Returns detailed information about a single backup.
      parameters:
        - name: id
          in: path
          required: true
          description: Backup UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Backup details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Backup"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    delete:
      operationId: deleteBackup
      tags: [Admin]
      summary: Delete backup
      description: Permanently deletes a backup and its associated data files.
      parameters:
        - name: id
          in: path
          required: true
          description: Backup UUID
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: Backup deleted
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/admin/backups/{id}/execute:
    parameters:
      - name: id
        in: path
        required: true
        description: Backup ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: executeBackup
      tags: [Admin]
      summary: Execute a backup
      description: Starts the backup process asynchronously.
      responses:
        "202":
          description: Backup execution started.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Backup"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/admin/backups/{id}/restore:
    post:
      operationId: restoreBackup
      tags: [Admin]
      summary: Restore from backup
      description: Initiates a system restore from the specified backup. This is a destructive operation that replaces current data.
      parameters:
        - name: id
          in: path
          required: true
          description: Backup UUID
          schema:
            type: string
            format: uuid
      responses:
        "202":
          description: Restore started
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AsyncTaskResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/admin/backups/{id}/cancel:
    parameters:
      - name: id
        in: path
        required: true
        description: Backup ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: cancelBackup
      tags: [Admin]
      summary: Cancel a running backup or restore
      description: Cancels a backup or restore operation that is currently in progress.
      responses:
        "200":
          description: Backup operation cancelled.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Backup"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/admin/settings:
    get:
      operationId: getSystemSettings
      tags: [Admin]
      summary: Get system settings
      description: Returns the current system-wide settings.
      responses:
        "200":
          description: System settings.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SystemSettings"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

    post:
      operationId: updateSystemSettings
      tags: [Admin]
      summary: Update system settings
      description: Replaces the system-wide settings with the provided values.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SystemSettings"
      responses:
        "200":
          description: Settings updated.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SystemSettings"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/v1/admin/stats:
    get:
      operationId: getSystemStats
      tags: [Admin]
      summary: Get system statistics
      description: Returns aggregate system statistics including user, repository, and artifact counts.
      responses:
        "200":
          description: System statistics.
          content:
            application/json:
              schema:
                type: object
                required: [users, repositories, artifacts, storage_used_bytes, total_downloads]
                properties:
                  users:
                    type: integer
                  repositories:
                    type: integer
                  artifacts:
                    type: integer
                  storage_used_bytes:
                    type: integer
                    format: int64
                  total_downloads:
                    type: integer
                    format: int64
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/v1/admin/cleanup:
    post:
      operationId: triggerCleanup
      tags: [Admin]
      summary: Trigger storage cleanup
      description: Starts an asynchronous job to remove orphaned files and expired artifacts.
      responses:
        "202":
          description: Cleanup job started.
          content:
            application/json:
              schema:
                type: object
                required: [job_id]
                properties:
                  job_id:
                    type: string
                    format: uuid
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/v1/admin/reindex:
    post:
      operationId: triggerReindex
      tags: [Admin]
      summary: Trigger search reindex
      description: Starts an asynchronous job to rebuild the search index from stored metadata.
      responses:
        "202":
          description: Reindex job started.
          content:
            application/json:
              schema:
                type: object
                required: [job_id]
                properties:
                  job_id:
                    type: string
                    format: uuid
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  # 
  # 16. Migration
  # 
  /api/v1/migrations/connections:
    get:
      operationId: listMigrationConnections
      tags: [Migration]
      summary: List migration connections
      description: Returns all configured migration source connections.
      responses:
        "200":
          description: List of migration connections
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/MigrationConnection"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/InternalServerError"

    post:
      operationId: createMigrationConnection
      tags: [Migration]
      summary: Create migration connection
      description: Creates a new connection to a remote artifact manager for migration.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, url, username, password, type]
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 128
                  example: prod-artifactory
                url:
                  type: string
                  format: uri
                  example: https://artifactory.example.com
                username:
                  type: string
                  example: admin
                password:
                  type: string
                  format: password
                type:
                  type: string
                  enum: [artifactory, nexus]
                  example: artifactory
      responses:
        "201":
          description: Migration connection created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MigrationConnection"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/migrations/connections/{id}:
    get:
      operationId: getMigrationConnection
      tags: [Migration]
      summary: Get migration connection
      description: Returns a single migration connection by its unique identifier.
      parameters:
        - name: id
          in: path
          required: true
          description: Connection UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Migration connection details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MigrationConnection"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    delete:
      operationId: deleteMigrationConnection
      tags: [Migration]
      summary: Delete migration connection
      description: Permanently deletes a migration connection. Fails if there are active migration jobs using this connection.
      parameters:
        - name: id
          in: path
          required: true
          description: Connection UUID
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: Migration connection deleted
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"

    patch:
      operationId: updateMigrationConnection
      tags: [Migration]
      summary: Update migration connection
      description: Partially updates migration connection details.
      parameters:
        - name: id
          in: path
          required: true
          description: Connection UUID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  maxLength: 128
                url:
                  type: string
                  format: uri
                username:
                  type: string
                password:
                  type: string
                  format: password
      responses:
        "200":
          description: Migration connection updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MigrationConnection"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/migrations/connections/{id}/test:
    post:
      operationId: testMigrationConnection
      tags: [Migration]
      summary: Test migration connection
      description: Tests connectivity and authentication against the remote artifact manager.
      parameters:
        - name: id
          in: path
          required: true
          description: Connection UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Connection test result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TestResultResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/migrations/connections/{id}/repositories:
    get:
      operationId: listRemoteRepositories
      tags: [Migration]
      summary: List remote repositories
      description: Lists repositories available on the remote artifact manager for migration.
      parameters:
        - name: id
          in: path
          required: true
          description: Connection UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: List of remote repositories
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/RemoteRepository"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/migrations:
    get:
      operationId: listMigrationJobs
      tags: [Migration]
      summary: List migration jobs
      description: Returns a paginated list of migration jobs, optionally filtered by status.
      parameters:
        - name: status
          in: query
          description: Filter by migration status (e.g. pending, running, completed, failed).
          schema:
            type: string
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/perPage"
      responses:
        "200":
          description: Paginated list of migration jobs.
          content:
            application/json:
              schema:
                type: object
                required: [items, pagination]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/MigrationJob"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "401":
          $ref: "#/components/responses/Unauthorized"

    post:
      operationId: createMigrationJob
      tags: [Migration]
      summary: Create a migration job
      description: Creates a new migration job to transfer artifacts from a source system.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [connection_id, source_repos, target_repos, options]
              properties:
                connection_id:
                  type: string
                  format: uuid
                  description: Source connection to migrate from.
                source_repos:
                  type: array
                  items:
                    type: string
                  description: List of source repository keys to migrate.
                target_repos:
                  type: array
                  items:
                    type: string
                  description: List of target repository keys to migrate into.
                options:
                  type: object
                  additionalProperties: true
                  description: Migration options (e.g. include_metadata, dry_run).
      responses:
        "201":
          description: Migration job created.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MigrationJob"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "422":
          $ref: "#/components/responses/UnprocessableEntity"

  /api/v1/migrations/jobs/{id}:
    parameters:
      - name: id
        in: path
        required: true
        description: Migration job ID.
        schema:
          type: string
          format: uuid

    get:
      operationId: getMigrationJob
      tags: [Migration]
      summary: Get a migration job
      description: Returns full details and progress of a migration job.
      responses:
        "200":
          description: Migration job details.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MigrationJob"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

    delete:
      operationId: deleteMigrationJob
      tags: [Migration]
      summary: Delete a migration job
      description: Removes a completed or cancelled migration job and its records.
      responses:
        "204":
          description: Migration job deleted.
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"

  /api/v1/migrations/jobs/{id}/start:
    parameters:
      - name: id
        in: path
        required: true
        description: Migration job ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: startMigrationJob
      tags: [Migration]
      summary: Start a migration job
      description: Begins executing a pending migration job asynchronously.
      responses:
        "202":
          description: Migration started.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MigrationJob"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"

  /api/v1/migrations/jobs/{id}/pause:
    parameters:
      - name: id
        in: path
        required: true
        description: Migration job ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: pauseMigrationJob
      tags: [Migration]
      summary: Pause a migration job
      description: Pauses a running migration job so it can be resumed later.
      responses:
        "200":
          description: Migration paused.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MigrationJob"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"

  /api/v1/migrations/jobs/{id}/resume:
    parameters:
      - name: id
        in: path
        required: true
        description: Migration job ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: resumeMigrationJob
      tags: [Migration]
      summary: Resume a migration job
      description: Resumes a paused migration job from where it left off.
      responses:
        "200":
          description: Migration resumed.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MigrationJob"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"

  /api/v1/migrations/jobs/{id}/cancel:
    parameters:
      - name: id
        in: path
        required: true
        description: Migration job ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: cancelMigrationJob
      tags: [Migration]
      summary: Cancel a migration job
      description: Cancels a running or paused migration job. Already-migrated artifacts are retained.
      responses:
        "200":
          description: Migration cancelled.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MigrationJob"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"

  /api/v1/migrations/jobs/{id}/stream:
    parameters:
      - name: id
        in: path
        required: true
        description: Migration job ID.
        schema:
          type: string
          format: uuid
    get:
      operationId: streamMigrationProgress
      tags: [Migration]
      summary: Stream migration progress
      description: Opens a Server-Sent Events stream for real-time migration progress updates.
      responses:
        "200":
          description: SSE event stream.
          content:
            text/event-stream:
              schema:
                type: string
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/migrations/jobs/{id}/items:
    parameters:
      - name: id
        in: path
        required: true
        description: Migration job ID.
        schema:
          type: string
          format: uuid
    get:
      operationId: listMigrationItems
      tags: [Migration]
      summary: List migration items
      description: Returns a paginated list of individual items in a migration job, optionally filtered by status.
      parameters:
        - name: status
          in: query
          description: Filter items by status (e.g. pending, completed, failed, skipped).
          schema:
            type: string
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/perPage"
      responses:
        "200":
          description: Paginated list of migration items.
          content:
            application/json:
              schema:
                type: object
                required: [items, pagination]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/MigrationItem"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/migrations/jobs/{id}/report:
    parameters:
      - name: id
        in: path
        required: true
        description: Migration job ID.
        schema:
          type: string
          format: uuid
    get:
      operationId: getMigrationReport
      tags: [Migration]
      summary: Get migration report
      description: Returns a comprehensive report of a completed or in-progress migration job.
      responses:
        "200":
          description: Migration report.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MigrationReport"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/migrations/jobs/{id}/assess:
    parameters:
      - name: id
        in: path
        required: true
        description: Migration job ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: assessMigration
      tags: [Migration]
      summary: Assess a migration
      description: Triggers an asynchronous assessment of the migration to estimate size, duration, and potential issues.
      responses:
        "202":
          description: Assessment started.
          content:
            application/json:
              schema:
                type: object
                required: [assessment_id]
                properties:
                  assessment_id:
                    type: string
                    format: uuid
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/migrations/jobs/{id}/assessment:
    parameters:
      - name: id
        in: path
        required: true
        description: Migration job ID.
        schema:
          type: string
          format: uuid
    get:
      operationId: getMigrationAssessment
      tags: [Migration]
      summary: Get migration assessment
      description: Returns the results of a previously triggered migration assessment.
      responses:
        "200":
          description: Migration assessment.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MigrationAssessment"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  # 
  # 17. Builds, Packages, Tree
  # 
  /api/v1/builds:
    get:
      operationId: listBuilds
      tags: [Builds]
      summary: List builds
      description: Returns a paginated list of recent builds.
      parameters:
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/perPage"
      responses:
        "200":
          description: Paginated list of builds
          content:
            application/json:
              schema:
                type: object
                required: [items, pagination]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/Build"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/builds/{id}:
    get:
      operationId: getBuild
      tags: [Builds]
      summary: Get build
      description: Returns detailed information about a single build.
      parameters:
        - name: id
          in: path
          required: true
          description: Build UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Build details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Build"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/builds/diff:
    get:
      operationId: diffBuilds
      tags: [Builds]
      summary: Compare two builds
      description: Returns a diff showing artifacts added, removed, or changed between two builds.
      parameters:
        - name: build1
          in: query
          required: true
          description: First build ID.
          schema:
            type: string
            format: uuid
        - name: build2
          in: query
          required: true
          description: Second build ID.
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Build diff.
          content:
            application/json:
              schema:
                type: object
                required:
                  - build_a
                  - build_b
                  - added
                  - removed
                  - modified
                properties:
                  build_a:
                    type: string
                    format: uuid
                  build_b:
                    type: string
                    format: uuid
                  added:
                    type: array
                    items:
                      $ref: "#/components/schemas/Artifact"
                  removed:
                    type: array
                    items:
                      $ref: "#/components/schemas/Artifact"
                  modified:
                    type: array
                    items:
                      $ref: "#/components/schemas/Artifact"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/packages:
    get:
      operationId: listPackages
      tags: [Packages]
      summary: List packages
      description: Returns a paginated list of packages with optional filtering by repository and format.
      parameters:
        - name: repository
          in: query
          description: Filter by repository key.
          schema:
            type: string
        - name: format
          in: query
          description: Filter by package format.
          schema:
            type: string
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/perPage"
      responses:
        "200":
          description: Paginated list of packages
          content:
            application/json:
              schema:
                type: object
                required: [items, pagination]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/Package"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/packages/{id}:
    get:
      operationId: getPackage
      tags: [Packages]
      summary: Get package
      description: Returns detailed information about a single package.
      parameters:
        - name: id
          in: path
          required: true
          description: Package UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Package details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Package"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/packages/{id}/versions:
    get:
      operationId: listPackageVersions
      tags: [Packages]
      summary: List package versions
      description: Returns all published versions of the specified package.
      parameters:
        - name: id
          in: path
          required: true
          description: Package UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: List of package versions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/PackageVersion"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  # =============================================================================
  # Tree Endpoints
  # =============================================================================

  /api/v1/tree/{path}:
    parameters:
      - name: path
        in: path
        required: true
        description: Catch-all path representing the storage tree location.
        schema:
          type: string
    get:
      operationId: browseTree
      tags: [Tree]
      summary: Browse the storage tree
      description: Returns directory and file entries at the specified path in the virtual storage tree.
      responses:
        "200":
          description: Tree node listing.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/TreeNode"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  # =============================================================================
  # Webhooks Endpoints
  # =============================================================================

  /api/v1/webhooks/{id}/deliveries/{delivery_id}:
    get:
      operationId: getWebhookDelivery
      tags: [Webhooks]
      summary: Get webhook delivery
      description: Returns full details of a single webhook delivery attempt including request and response bodies.
      parameters:
        - name: id
          in: path
          required: true
          description: Webhook UUID
          schema:
            type: string
            format: uuid
        - name: delivery_id
          in: path
          required: true
          description: Delivery UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Delivery details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WebhookDelivery"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/plugins/{id}/upgrade:
    post:
      operationId: upgradePlugin
      tags: [Plugins]
      summary: Upgrade plugin
      description: Upgrades the plugin to the latest available version from its original source.
      parameters:
        - name: id
          in: path
          required: true
          description: Plugin UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Plugin upgraded
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Plugin"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/plugins/{id}/health:
    get:
      operationId: getPluginHealth
      tags: [Plugins]
      summary: Get plugin health
      description: Returns the current health status and resource usage of the specified plugin.
      parameters:
        - name: id
          in: path
          required: true
          description: Plugin UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Plugin health status
          content:
            application/json:
              schema:
                type: object
                required: [status, uptime_seconds]
                properties:
                  status:
                    type: string
                    enum: [healthy, degraded, unhealthy]
                  uptime_seconds:
                    type: integer
                  memory_usage_bytes:
                    type: integer
                  last_error:
                    type: ["string", "null"]
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/plugins/{id}/restart:
    post:
      operationId: restartPlugin
      tags: [Plugins]
      summary: Restart plugin
      description: Restarts a plugin that is in an error state, reinitializing its WASM runtime.
      parameters:
        - name: id
          in: path
          required: true
          description: Plugin UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Plugin restarted
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Plugin"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  # =============================================================================
  # Formats Endpoints
  # =============================================================================

  /api/v1/signing/sign:
    post:
      operationId: signArtifact
      tags: [Signing]
      summary: Sign artifact
      description: Creates a cryptographic signature for the specified artifact using the given signing key.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [artifact_id, key_id]
              properties:
                artifact_id:
                  type: string
                  format: uuid
                key_id:
                  type: string
                  format: uuid
      responses:
        "201":
          description: Artifact signed
          content:
            application/json:
              schema:
                type: object
                required: [signature_id, artifact_id, key_id, created_at]
                properties:
                  signature_id:
                    type: string
                    format: uuid
                  artifact_id:
                    type: string
                    format: uuid
                  key_id:
                    type: string
                    format: uuid
                  created_at:
                    type: string
                    format: date-time
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/signing/verify:
    post:
      operationId: verifyArtifact
      tags: [Signing]
      summary: Verify artifact signature
      description: Verifies all signatures on the specified artifact and returns the verification results.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [artifact_id]
              properties:
                artifact_id:
                  type: string
                  format: uuid
      responses:
        "200":
          description: Verification result
          content:
            application/json:
              schema:
                type: object
                required: [artifact_id, verified, signatures]
                properties:
                  artifact_id:
                    type: string
                    format: uuid
                  verified:
                    type: boolean
                  signatures:
                    type: array
                    items:
                      type: object
                      required: [signature_id, key_id, valid]
                      properties:
                        signature_id:
                          type: string
                          format: uuid
                        key_id:
                          type: string
                          format: uuid
                        valid:
                          type: boolean
                        reason:
                          type: ["string", "null"]
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/signing/artifacts/{artifact_id}/signatures:
    get:
      operationId: listArtifactSignatures
      tags: [Signing]
      summary: List artifact signatures
      description: Returns all signatures associated with the specified artifact.
      parameters:
        - name: artifact_id
          in: path
          required: true
          description: Artifact UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: List of signatures
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  required: [signature_id, artifact_id, key_id, created_at]
                  properties:
                    signature_id:
                      type: string
                      format: uuid
                    artifact_id:
                      type: string
                      format: uuid
                    key_id:
                      type: string
                      format: uuid
                    created_at:
                      type: string
                      format: date-time
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/signing/signatures/{signature_id}:
    delete:
      operationId: deleteSignature
      tags: [Signing]
      summary: Delete signature
      description: Permanently deletes a single artifact signature.
      parameters:
        - name: signature_id
          in: path
          required: true
          description: Signature UUID
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: Signature deleted
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  # =============================================================================
  # Security Endpoints
  # =============================================================================

  /api/v1/security/scores/{repository_key}:
    get:
      operationId: getSecurityScore
      tags: [Security]
      summary: Get repository security score
      description: Returns the security score and vulnerability counts for a specific repository.
      parameters:
        - name: repository_key
          in: path
          required: true
          description: Repository key
          schema:
            type: string
      responses:
        "200":
          description: Repository security score
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SecurityScore"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/security/summary:
    get:
      operationId: getSecuritySummary
      tags: [Security]
      summary: Security summary
      description: Returns an aggregate security summary with total vulnerability counts across all repositories.
      responses:
        "200":
          description: Aggregate security summary
          content:
            application/json:
              schema:
                type: object
                required: [total_repositories, scanned_repositories, total_findings, critical_count, high_count, medium_count, low_count]
                properties:
                  total_repositories:
                    type: integer
                  scanned_repositories:
                    type: integer
                  total_findings:
                    type: integer
                  critical_count:
                    type: integer
                  high_count:
                    type: integer
                  medium_count:
                    type: integer
                  low_count:
                    type: integer
                  last_scan_at:
                    type: ["string", "null"]
                    format: date-time
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  # =============================================================================
  # Edge Nodes Endpoints
  # =============================================================================

  /api/v1/edge-nodes/{id}/peers/{peerId}:
    delete:
      operationId: removeEdgeNodePeer
      tags: [Edge Nodes]
      summary: Remove peer connection
      description: Removes a peer connection between two edge nodes.
      parameters:
        - name: id
          in: path
          required: true
          description: Edge node UUID
          schema:
            type: string
            format: uuid
        - name: peerId
          in: path
          required: true
          description: Peer node UUID
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: Peer connection removed
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/edge-nodes/{id}/peers/scored:
    get:
      operationId: getScoredPeers
      tags: [Edge Nodes]
      summary: Get scored peers
      description: Returns peer nodes scored by latency, bandwidth, and chunk availability for optimal transfer source selection.
      parameters:
        - name: id
          in: path
          required: true
          description: Edge node UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Scored peer list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ScoredPeer"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/edge-nodes/{id}/network-profile:
    get:
      operationId: getEdgeNodeNetworkProfile
      tags: [Edge Nodes]
      summary: Get network profile
      description: Returns the network profile including bandwidth and concurrency limits for the specified edge node.
      parameters:
        - name: id
          in: path
          required: true
          description: Edge node UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Network profile
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NetworkProfile"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    put:
      operationId: updateEdgeNodeNetworkProfile
      tags: [Edge Nodes]
      summary: Update network profile
      description: Replaces the network profile for the specified edge node.
      parameters:
        - name: id
          in: path
          required: true
          description: Edge node UUID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [upload_bandwidth_mbps, download_bandwidth_mbps, max_concurrent_transfers]
              properties:
                upload_bandwidth_mbps:
                  type: number
                download_bandwidth_mbps:
                  type: number
                max_concurrent_transfers:
                  type: integer
                  minimum: 1
      responses:
        "200":
          description: Network profile updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NetworkProfile"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/edge-nodes/{id}/transfers:
    post:
      operationId: startTransfer
      tags: [Edge Nodes]
      summary: Start chunked transfer
      description: Initiates a new chunked transfer session for an artifact to or from the edge node.
      parameters:
        - name: id
          in: path
          required: true
          description: Edge node UUID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [artifact_id]
              properties:
                artifact_id:
                  type: string
                  format: uuid
                target_node_id:
                  type: string
                  format: uuid
                  description: Optional target node for node-to-node transfers.
      responses:
        "201":
          description: Transfer session created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransferSession"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    get:
      operationId: listTransfers
      tags: [Edge Nodes]
      summary: List transfer sessions
      description: Returns all transfer sessions for the specified edge node.
      parameters:
        - name: id
          in: path
          required: true
          description: Edge node UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: List of transfer sessions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/TransferSession"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/edge-nodes/{id}/transfers/{transfer_id}:
    get:
      operationId: getTransfer
      tags: [Edge Nodes]
      summary: Get transfer session
      description: Returns detailed information about a single transfer session.
      parameters:
        - name: id
          in: path
          required: true
          description: Edge node UUID
          schema:
            type: string
            format: uuid
        - name: transfer_id
          in: path
          required: true
          description: Transfer session UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Transfer session details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransferSession"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/edge-nodes/{id}/transfers/{transfer_id}/manifest:
    get:
      operationId: getTransferManifest
      tags: [Edge Nodes]
      summary: Get chunk manifest
      description: Returns the chunk manifest for a transfer session, listing all chunks with their sizes and checksums.
      parameters:
        - name: id
          in: path
          required: true
          description: Edge node UUID
          schema:
            type: string
            format: uuid
        - name: transfer_id
          in: path
          required: true
          description: Transfer session UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Chunk manifest
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ChunkManifest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/edge-nodes/{id}/transfers/{transfer_id}/chunks/{chunk_index}:
    put:
      operationId: uploadChunk
      tags: [Edge Nodes]
      summary: Upload chunk
      description: Uploads a single binary chunk for the specified transfer session.
      parameters:
        - name: id
          in: path
          required: true
          description: Edge node UUID
          schema:
            type: string
            format: uuid
        - name: transfer_id
          in: path
          required: true
          description: Transfer session UUID
          schema:
            type: string
            format: uuid
        - name: chunk_index
          in: path
          required: true
          description: Zero-based chunk index
          schema:
            type: integer
            minimum: 0
      requestBody:
        required: true
        content:
          application/octet-stream:
            schema:
              type: string
              format: binary
      responses:
        "204":
          description: Chunk uploaded
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    get:
      operationId: downloadChunk
      tags: [Edge Nodes]
      summary: Download chunk
      description: Downloads a single binary chunk from the specified transfer session.
      parameters:
        - name: id
          in: path
          required: true
          description: Edge node UUID
          schema:
            type: string
            format: uuid
        - name: transfer_id
          in: path
          required: true
          description: Transfer session UUID
          schema:
            type: string
            format: uuid
        - name: chunk_index
          in: path
          required: true
          description: Zero-based chunk index
          schema:
            type: integer
            minimum: 0
      responses:
        "200":
          description: Chunk binary content
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/edge-nodes/{id}/transfers/{transfer_id}/complete:
    post:
      operationId: completeTransfer
      tags: [Edge Nodes]
      summary: Complete transfer
      description: Marks a transfer session as complete after all chunks have been uploaded and verified.
      parameters:
        - name: id
          in: path
          required: true
          description: Edge node UUID
          schema:
            type: string
            format: uuid
        - name: transfer_id
          in: path
          required: true
          description: Transfer session UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Transfer completed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransferSession"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/edge-nodes/{id}/transfers/{transfer_id}/cancel:
    post:
      operationId: cancelTransfer
      tags: [Edge Nodes]
      summary: Cancel transfer
      description: Cancels an in-progress transfer session and cleans up any uploaded chunks.
      parameters:
        - name: id
          in: path
          required: true
          description: Edge node UUID
          schema:
            type: string
            format: uuid
        - name: transfer_id
          in: path
          required: true
          description: Transfer session UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Transfer cancelled
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransferSession"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/edge-nodes/{id}/cache:
    get:
      operationId: getEdgeNodeCache
      tags: [Edge Nodes]
      summary: Get cache stats
      description: Returns cache contents and usage statistics for the specified edge node.
      parameters:
        - name: id
          in: path
          required: true
          description: Edge node UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Cache statistics
          content:
            application/json:
              schema:
                type: object
                required: [cache_size_mb, capacity_mb, item_count]
                properties:
                  cache_size_mb:
                    type: integer
                  capacity_mb:
                    type: integer
                  item_count:
                    type: integer
                  hit_rate:
                    type: number
                    description: Cache hit rate as a decimal between 0 and 1.
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    delete:
      operationId: purgeEdgeNodeCache
      tags: [Edge Nodes]
      summary: Purge cache
      description: Purges all cached content from the specified edge node.
      parameters:
        - name: id
          in: path
          required: true
          description: Edge node UUID
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: Cache purged
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/edge-nodes/{id}/repositories:
    post:
      operationId: assignEdgeNodeRepositories
      tags: [Edge Nodes]
      summary: Assign repositories
      description: Assigns one or more repositories to the edge node for caching and distribution.
      parameters:
        - name: id
          in: path
          required: true
          description: Edge node UUID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [repository_keys]
              properties:
                repository_keys:
                  type: array
                  items:
                    type: string
                  minItems: 1
      responses:
        "200":
          description: Repositories assigned
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EdgeNode"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  # =============================================================================
  # Admin Endpoints
  # =============================================================================

  /api/v1/admin/system/gc:
    post:
      operationId: triggerGarbageCollection
      tags: [Admin]
      summary: Trigger garbage collection
      description: Triggers a garbage collection pass to reclaim storage from orphaned blobs and deleted artifacts.
      responses:
        "202":
          description: Garbage collection started
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AsyncTaskResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/admin/search/reindex:
    post:
      operationId: reindexSearch
      tags: [Admin]
      summary: Reindex search
      description: Triggers a full reindex of the search index from the database. Use after bulk imports or data recovery.
      responses:
        "202":
          description: Reindex started
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AsyncTaskResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/admin/backups/{id}/download:
    get:
      operationId: downloadBackup
      tags: [Admin]
      summary: Download backup
      description: Downloads the backup archive file.
      parameters:
        - name: id
          in: path
          required: true
          description: Backup UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Backup file
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/admin/audit-log:
    get:
      operationId: queryAuditLog
      tags: [Admin]
      summary: Query audit log
      description: Returns a paginated audit log with optional filtering by user, action, and date range.
      parameters:
        - name: user_id
          in: query
          description: Filter by user UUID.
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          description: Filter by action type.
          schema:
            type: string
        - name: from
          in: query
          description: Start of date range (inclusive).
          schema:
            type: string
            format: date-time
        - name: to
          in: query
          description: End of date range (inclusive).
          schema:
            type: string
            format: date-time
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/perPage"
      responses:
        "200":
          description: Paginated audit log entries
          content:
            application/json:
              schema:
                type: object
                required: [items, pagination]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/AuditLogEntry"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/InternalServerError"

  # =============================================================================
  # Migration Endpoints
  # =============================================================================

  /api/v1/migrations/jobs/{id}/items/{itemId}/retry:
    post:
      operationId: retryMigrationItem
      tags: [Migration]
      summary: Retry failed item
      description: Retries a previously failed migration item.
      parameters:
        - name: id
          in: path
          required: true
          description: Migration job UUID
          schema:
            type: string
            format: uuid
        - name: itemId
          in: path
          required: true
          description: Migration item UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Item retry initiated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MigrationItem"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  # =============================================================================
  # Builds Endpoints
  # =============================================================================

  /api/v1/builds/{id}/artifacts:
    get:
      operationId: listBuildArtifacts
      tags: [Builds]
      summary: List build artifacts
      description: Returns all artifacts associated with the specified build.
      parameters:
        - name: id
          in: path
          required: true
          description: Build UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: List of artifacts for the build
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Artifact"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  # =============================================================================
  # Packages Endpoints
  # =============================================================================

  /api/v1/repositories/{repository_key}/tree:
    get:
      operationId: getRepositoryTree
      tags: [Tree]
      summary: Get repository file tree
      description: Returns a hierarchical file tree for the specified repository with optional path scoping and depth limiting.
      parameters:
        - name: repository_key
          in: path
          required: true
          description: Repository key
          schema:
            type: string
        - name: path
          in: query
          description: Subtree path to start from. Defaults to the repository root.
          schema:
            type: string
        - name: depth
          in: query
          description: Maximum depth of the tree to return.
          schema:
            type: integer
            minimum: 1
      responses:
        "200":
          description: Repository file tree
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TreeNode"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  # =============================================================================
  # SBOM Endpoints
  # =============================================================================

  /api/v1/sbom:
    post:
      operationId: generateSbom
      tags: [SBOM]
      summary: Generate SBOM for artifact
      description: Generates a Software Bill of Materials for the specified artifact in the requested format. If an SBOM already exists, returns the cached version unless force_regenerate is set.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [artifact_id]
              properties:
                artifact_id:
                  type: string
                  format: uuid
                  description: ID of the artifact to generate an SBOM for.
                format:
                  type: string
                  default: cyclonedx
                  description: SBOM output format (e.g. cyclonedx, spdx).
                force_regenerate:
                  type: boolean
                  default: false
                  description: When true, regenerates the SBOM even if a cached version exists.
      responses:
        "201":
          description: SBOM generated successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SbomResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "422":
          $ref: "#/components/responses/UnprocessableEntity"
        "500":
          $ref: "#/components/responses/InternalServerError"

    get:
      operationId: listSboms
      tags: [SBOM]
      summary: List SBOMs
      description: Returns a list of generated SBOMs with optional filtering by artifact, repository, or format.
      parameters:
        - name: artifact_id
          in: query
          description: Filter by artifact ID.
          schema:
            type: string
            format: uuid
        - name: repository_id
          in: query
          description: Filter by repository ID.
          schema:
            type: string
            format: uuid
        - name: format
          in: query
          description: Filter by SBOM format (e.g. cyclonedx, spdx).
          schema:
            type: string
      responses:
        "200":
          description: List of SBOMs.
          content:
            application/json:
              schema:
                type: object
                required: [items]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/SbomResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/sbom/{sbom_id}:
    parameters:
      - name: sbom_id
        in: path
        required: true
        description: SBOM identifier
        schema:
          type: string
          format: uuid
    get:
      operationId: getSbom
      tags: [SBOM]
      summary: Get SBOM with content
      description: Returns full SBOM details including the raw SBOM document content as a JSON object.
      responses:
        "200":
          description: SBOM with content.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SbomContentResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/sbom/{sbom_id}/components:
    parameters:
      - name: sbom_id
        in: path
        required: true
        description: SBOM identifier
        schema:
          type: string
          format: uuid
    get:
      operationId: getSbomComponents
      tags: [SBOM]
      summary: List SBOM components
      description: Returns the list of software components declared in the specified SBOM, including package URLs, licenses, and checksums.
      responses:
        "200":
          description: List of SBOM components.
          content:
            application/json:
              schema:
                type: object
                required: [items]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/ComponentResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/sbom/{sbom_id}/convert:
    parameters:
      - name: sbom_id
        in: path
        required: true
        description: SBOM identifier
        schema:
          type: string
          format: uuid
    post:
      operationId: convertSbom
      tags: [SBOM]
      summary: Convert SBOM format
      description: Converts an existing SBOM to a different format (e.g. CycloneDX to SPDX or vice versa) and stores the result as a new SBOM record.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [target_format]
              properties:
                target_format:
                  type: string
                  description: Target SBOM format to convert to (e.g. spdx, cyclonedx).
      responses:
        "200":
          description: Converted SBOM.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SbomResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "422":
          $ref: "#/components/responses/UnprocessableEntity"
        "500":
          $ref: "#/components/responses/InternalServerError"

  # ---------------------------------------------------------------------------
  # SBOM  CVE History & Trends
  # ---------------------------------------------------------------------------

  /api/v1/sbom/cve/history/{artifact_id}:
    parameters:
      - name: artifact_id
        in: path
        required: true
        description: Artifact identifier
        schema:
          type: string
          format: uuid
    get:
      operationId: getCveHistory
      tags: [SBOM]
      summary: Get CVE history for artifact
      description: Returns the chronological list of CVEs detected across all SBOM scans for the given artifact, including current status and acknowledgement details.
      responses:
        "200":
          description: CVE history entries.
          content:
            application/json:
              schema:
                type: object
                required: [items]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/CveHistoryEntry"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/sbom/cve/status/{id}:
    parameters:
      - name: id
        in: path
        required: true
        description: CVE history entry identifier
        schema:
          type: string
          format: uuid
    post:
      operationId: updateCveStatus
      tags: [SBOM]
      summary: Update CVE status
      description: Updates the triage status of a CVE history entry, optionally recording a reason for the status change.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [status]
              properties:
                status:
                  type: string
                  description: New CVE triage status (e.g. open, acknowledged, mitigated, false_positive).
                reason:
                  type: string
                  description: Optional explanation for the status change.
      responses:
        "200":
          description: Updated CVE history entry.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CveHistoryEntry"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/sbom/cve/trends:
    get:
      operationId: getCveTrends
      tags: [SBOM]
      summary: Get CVE trends
      description: Returns aggregated CVE trend data over a configurable time window, broken down by severity. Useful for dashboards and reporting.
      parameters:
        - name: repository_id
          in: query
          description: Limit trends to a specific repository.
          schema:
            type: string
            format: uuid
        - name: days
          in: query
          description: Number of days to look back for trend data.
          schema:
            type: integer
            default: 30
            minimum: 1
            maximum: 365
      responses:
        "200":
          description: CVE trend data.
          content:
            application/json:
              schema:
                type: object
                required: [period_days, total_cves, new_cves, resolved_cves, by_severity, daily]
                properties:
                  period_days:
                    type: integer
                    description: Number of days covered by the trend window.
                  total_cves:
                    type: integer
                    description: Total open CVEs at the end of the period.
                  new_cves:
                    type: integer
                    description: CVEs first detected during the period.
                  resolved_cves:
                    type: integer
                    description: CVEs resolved during the period.
                  by_severity:
                    type: object
                    description: Counts keyed by severity level (critical, high, medium, low).
                    additionalProperties:
                      type: integer
                  daily:
                    type: array
                    description: Per-day breakdown of CVE counts.
                    items:
                      type: object
                      required: [date, open, new, resolved]
                      properties:
                        date:
                          type: string
                          format: date
                        open:
                          type: integer
                        new:
                          type: integer
                        resolved:
                          type: integer
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  # ---------------------------------------------------------------------------
  # License Policies
  # ---------------------------------------------------------------------------

  /api/v1/license-policies:
    get:
      operationId: listLicensePolicies
      tags: [SBOM]
      summary: List license policies
      description: Returns all configured license compliance policies, optionally filtered by repository.
      responses:
        "200":
          description: List of license policies.
          content:
            application/json:
              schema:
                type: object
                required: [items]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/LicensePolicyResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

    post:
      operationId: upsertLicensePolicy
      tags: [SBOM]
      summary: Create or update license policy
      description: Creates a new license compliance policy or updates an existing one. Policies define which licenses are allowed or denied for artifacts in a repository.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, allowed_licenses, denied_licenses, allow_unknown, action, is_enabled]
              properties:
                repository_id:
                  type: string
                  format: uuid
                  description: Scope the policy to a specific repository. Null for global policies.
                name:
                  type: string
                  description: Human-readable policy name.
                description:
                  type: string
                  description: Optional description of the policy intent.
                allowed_licenses:
                  type: array
                  items:
                    type: string
                  description: SPDX license identifiers that are explicitly permitted.
                denied_licenses:
                  type: array
                  items:
                    type: string
                  description: SPDX license identifiers that are explicitly prohibited.
                allow_unknown:
                  type: boolean
                  description: Whether to permit artifacts with unrecognised licenses.
                action:
                  type: string
                  description: Enforcement action when a violation is detected (e.g. warn, block).
                is_enabled:
                  type: boolean
                  description: Whether the policy is currently active.
      responses:
        "200":
          description: License policy created or updated.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LicensePolicyResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "422":
          $ref: "#/components/responses/UnprocessableEntity"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/license-policies/{id}:
    parameters:
      - name: id
        in: path
        required: true
        description: License policy identifier
        schema:
          type: string
          format: uuid
    get:
      operationId: getLicensePolicy
      tags: [SBOM]
      summary: Get license policy
      description: Returns full details of a single license compliance policy.
      responses:
        "200":
          description: License policy details.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LicensePolicyResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    delete:
      operationId: deleteLicensePolicy
      tags: [SBOM]
      summary: Delete license policy
      description: Permanently removes a license compliance policy. This action cannot be undone.
      responses:
        "204":
          description: License policy deleted.
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/sbom/check-compliance:
    post:
      operationId: checkLicenseCompliance
      tags: [SBOM]
      summary: Check license compliance
      description: Evaluates a set of SPDX license identifiers against all active license policies (or those scoped to a specific repository) and returns the compliance result.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [licenses]
              properties:
                licenses:
                  type: array
                  items:
                    type: string
                  description: List of SPDX license identifiers to check.
                repository_id:
                  type: string
                  format: uuid
                  description: Optionally scope the check to policies for a specific repository.
      responses:
        "200":
          description: License compliance result.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LicenseCheckResult"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "422":
          $ref: "#/components/responses/UnprocessableEntity"
        "500":
          $ref: "#/components/responses/InternalServerError"

  # =============================================================================
  # Promotion / Staging Endpoints
  # =============================================================================

  /api/v1/repositories/{key}/promote:
    parameters:
      - name: key
        in: path
        required: true
        description: Source repository key
        schema:
          type: string
    post:
      operationId: bulkPromoteArtifacts
      tags: [Repositories]
      summary: Bulk promote artifacts
      description: Promotes multiple artifacts from the source repository to a target repository in a single operation. Optionally runs promotion policies before executing.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [target_repository, artifact_ids, skip_policy_check]
              properties:
                target_repository:
                  type: string
                  description: Key of the target repository to promote into.
                artifact_ids:
                  type: array
                  items:
                    type: string
                    format: uuid
                  description: List of artifact IDs to promote.
                skip_policy_check:
                  type: boolean
                  description: When true, bypasses promotion policy evaluation.
                notes:
                  type: string
                  description: Optional free-text notes attached to the promotion record.
      responses:
        "200":
          description: Bulk promotion result.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BulkPromotionResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "422":
          $ref: "#/components/responses/UnprocessableEntity"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/repositories/{key}/artifacts/{artifact_id}/promote:
    parameters:
      - name: key
        in: path
        required: true
        description: Source repository key
        schema:
          type: string
      - name: artifact_id
        in: path
        required: true
        description: Artifact identifier
        schema:
          type: string
          format: uuid
    post:
      operationId: promoteArtifact
      tags: [Repositories]
      summary: Promote single artifact
      description: Promotes a single artifact from the source repository to a target repository. Runs promotion policies unless explicitly skipped.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [target_repository, skip_policy_check]
              properties:
                target_repository:
                  type: string
                  description: Key of the target repository to promote into.
                skip_policy_check:
                  type: boolean
                  description: When true, bypasses promotion policy evaluation.
                notes:
                  type: string
                  description: Optional free-text notes attached to the promotion record.
      responses:
        "200":
          description: Promotion result.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PromotionResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "422":
          $ref: "#/components/responses/UnprocessableEntity"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/repositories/{key}/promotion-history:
    parameters:
      - name: key
        in: path
        required: true
        description: Repository key
        schema:
          type: string
    get:
      operationId: getPromotionHistory
      tags: [Repositories]
      summary: Get promotion history
      description: Returns a paginated list of promotion events for the specified repository, including policy evaluation results and operator notes.
      parameters:
        - name: artifact_id
          in: query
          description: Filter history to a specific artifact.
          schema:
            type: string
            format: uuid
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/perPage"
      responses:
        "200":
          description: Paginated promotion history.
          content:
            application/json:
              schema:
                type: object
                required: [items, pagination]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/PromotionHistoryEntry"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"
  # =============================================================================
  # Dependency-Track Endpoints
  # =============================================================================

  /api/v1/dependency-track/status:
    get:
      operationId: getDependencyTrackStatus
      tags: [Dependency Track]
      summary: Get Dependency-Track integration status
      description: Returns the current status of the Dependency-Track integration including whether it is enabled and healthy.
      responses:
        "200":
          description: Dependency-Track status
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DtStatusResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/dependency-track/projects:
    get:
      operationId: listDtProjects
      tags: [Dependency Track]
      summary: List Dependency-Track projects
      description: Returns all projects tracked in the Dependency-Track integration.
      responses:
        "200":
          description: List of Dependency-Track projects
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/DtProject"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/dependency-track/projects/{project_uuid}:
    get:
      operationId: getDtProject
      tags: [Dependency Track]
      summary: Get Dependency-Track project
      description: Returns a single Dependency-Track project by UUID, including its associated findings.
      parameters:
        - name: project_uuid
          in: path
          required: true
          description: Dependency-Track project UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Dependency-Track project with findings
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DtProject"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/dependency-track/projects/{project_uuid}/findings:
    get:
      operationId: getDtProjectFindings
      tags: [Dependency Track]
      summary: List project findings
      description: Returns all vulnerability findings for the specified Dependency-Track project.
      parameters:
        - name: project_uuid
          in: path
          required: true
          description: Dependency-Track project UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: List of findings for the project
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/DtFinding"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/dependency-track/projects/{project_uuid}/components:
    get:
      operationId: getDtProjectComponents
      tags: [Dependency Track]
      summary: List project components
      description: Returns all components (dependencies) for the specified Dependency-Track project.
      parameters:
        - name: project_uuid
          in: path
          required: true
          description: Dependency-Track project UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: List of components for the project
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/DtComponentFull"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/dependency-track/projects/{project_uuid}/metrics:
    get:
      operationId: getDtProjectMetrics
      tags: [Dependency Track]
      summary: Get project metrics
      description: Returns the current vulnerability and policy violation metrics for the specified Dependency-Track project.
      parameters:
        - name: project_uuid
          in: path
          required: true
          description: Dependency-Track project UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Project metrics
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DtProjectMetrics"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/dependency-track/projects/{project_uuid}/metrics/history:
    get:
      operationId: getDtProjectMetricsHistory
      tags: [Dependency Track]
      summary: Get project metrics history
      description: Returns historical vulnerability and policy violation metrics for the specified Dependency-Track project over the given number of days.
      parameters:
        - name: project_uuid
          in: path
          required: true
          description: Dependency-Track project UUID
          schema:
            type: string
            format: uuid
        - name: days
          in: query
          required: false
          description: Number of days of history to retrieve
          schema:
            type: integer
            default: 30
            minimum: 1
      responses:
        "200":
          description: Historical project metrics
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/DtProjectMetrics"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/dependency-track/metrics/portfolio:
    get:
      operationId: getDtPortfolioMetrics
      tags: [Dependency Track]
      summary: Get portfolio metrics
      description: Returns aggregate vulnerability and policy violation metrics across all Dependency-Track projects.
      responses:
        "200":
          description: Portfolio-wide metrics
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DtPortfolioMetrics"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/dependency-track/projects/{project_uuid}/violations:
    get:
      operationId: getDtProjectViolations
      tags: [Dependency Track]
      summary: List project policy violations
      description: Returns all policy violations for the specified Dependency-Track project.
      parameters:
        - name: project_uuid
          in: path
          required: true
          description: Dependency-Track project UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: List of policy violations for the project
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/DtPolicyViolation"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/dependency-track/analysis:
    put:
      operationId: updateDtAnalysis
      tags: [Dependency Track]
      summary: Update finding analysis
      description: Updates the analysis state, justification, and suppression status for a specific vulnerability finding in Dependency-Track.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - project_uuid
                - component_uuid
                - vulnerability_uuid
                - state
                - suppressed
              properties:
                project_uuid:
                  type: string
                  format: uuid
                  description: UUID of the Dependency-Track project
                component_uuid:
                  type: string
                  format: uuid
                  description: UUID of the component with the finding
                vulnerability_uuid:
                  type: string
                  format: uuid
                  description: UUID of the vulnerability
                state:
                  type: string
                  description: Analysis state (e.g. NOT_SET, EXPLOITABLE, IN_TRIAGE, FALSE_POSITIVE, NOT_AFFECTED)
                justification:
                  type: string
                  description: Justification for the analysis decision
                details:
                  type: string
                  description: Additional details about the analysis
                suppressed:
                  type: boolean
                  description: Whether the finding should be suppressed
      responses:
        "200":
          description: Analysis updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DtAnalysisResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/dependency-track/policies:
    get:
      operationId: listDtPolicies
      tags: [Dependency Track]
      summary: List Dependency-Track policies
      description: Returns all policies configured in Dependency-Track, including their conditions and associated projects.
      responses:
        "200":
          description: List of Dependency-Track policies
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/DtPolicyFull"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  # =============================================================================
  # TOTP Endpoints
  # =============================================================================

  /api/v1/auth/totp/setup:
    post:
      operationId: setupTotp
      tags: [Auth]
      summary: Generate TOTP secret
      description: Generates a new TOTP secret and QR code URL for the authenticated user to configure their authenticator app.
      responses:
        "200":
          description: TOTP setup details including secret and QR code URL
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TotpSetupResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/auth/totp/enable:
    post:
      operationId: enableTotp
      tags: [Auth]
      summary: Enable TOTP two-factor authentication
      description: Verifies the provided TOTP code against the previously generated secret and enables TOTP for the authenticated user. Returns one-time backup codes.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [code]
              properties:
                code:
                  type: string
                  description: Six-digit TOTP code from the authenticator app
                  minLength: 6
                  maxLength: 6
      responses:
        "200":
          description: TOTP enabled successfully with backup codes
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TotpEnableResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/auth/totp/disable:
    post:
      operationId: disableTotp
      tags: [Auth]
      summary: Disable TOTP two-factor authentication
      description: Disables TOTP two-factor authentication for the authenticated user after verifying their password and a valid TOTP code.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [password, code]
              properties:
                password:
                  type: string
                  format: password
                  description: The user's current account password
                code:
                  type: string
                  description: Six-digit TOTP code from the authenticator app
                  minLength: 6
                  maxLength: 6
      responses:
        "200":
          description: TOTP disabled successfully
          content:
            application/json:
              schema:
                type: object
                required: [message]
                properties:
                  message:
                    type: string
                    example: TOTP has been disabled
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/public/auth/totp/verify:
    post:
      operationId: verifyTotp
      tags: [Auth]
      summary: Verify TOTP code during login
      description: Verifies a TOTP code as the second factor during the login flow. Accepts a temporary TOTP token issued after primary authentication and returns full access and refresh tokens upon successful verification.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [totp_token, code]
              properties:
                totp_token:
                  type: string
                  description: Temporary token received from the login endpoint when TOTP is required
                code:
                  type: string
                  description: Six-digit TOTP code from the authenticator app
                  minLength: 6
                  maxLength: 6
      responses:
        "200":
          description: TOTP verification successful, tokens issued
          content:
            application/json:
              schema:
                type: object
                required:
                  - access_token
                  - refresh_token
                  - token_type
                  - expires_in
                  - must_change_password
                properties:
                  access_token:
                    type: string
                  refresh_token:
                    type: string
                  token_type:
                    type: string
                    enum: [Bearer]
                  expires_in:
                    type: integer
                    description: Token lifetime in seconds
                  must_change_password:
                    type: boolean
                    description: Whether the user must change their password before proceeding
                  totp_required:
                    type:
                      - boolean
                      - "null"
                    description: Always false after successful TOTP verification
                  totp_token:
                    type:
                      - string
                      - "null"
                    description: Always null after successful TOTP verification
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  # =============================================================================
  # SSO Admin Endpoints
  # =============================================================================

  /api/v1/admin/auth/sso-admin/oidc:
    get:
      operationId: listOidcConfigs
      tags: [SSO Admin]
      summary: List OIDC configurations
      description: Returns all configured OIDC identity provider configurations. Requires admin privileges.
      responses:
        "200":
          description: List of OIDC configurations
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/OidcConfigResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/InternalServerError"

    post:
      operationId: createOidcConfig
      tags: [SSO Admin]
      summary: Create OIDC configuration
      description: Creates a new OIDC identity provider configuration. Requires admin privileges.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateOidcConfigRequest"
      responses:
        "201":
          description: OIDC configuration created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OidcConfigResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/admin/auth/sso-admin/oidc/{id}:
    get:
      operationId: getOidcConfig
      tags: [SSO Admin]
      summary: Get OIDC configuration
      description: Returns a single OIDC identity provider configuration by ID. Requires admin privileges.
      parameters:
        - name: id
          in: path
          required: true
          description: OIDC configuration UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: OIDC configuration details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OidcConfigResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    put:
      operationId: updateOidcConfig
      tags: [SSO Admin]
      summary: Update OIDC configuration
      description: Replaces an existing OIDC identity provider configuration. Requires admin privileges.
      parameters:
        - name: id
          in: path
          required: true
          description: OIDC configuration UUID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateOidcConfigRequest"
      responses:
        "200":
          description: OIDC configuration updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OidcConfigResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"

    delete:
      operationId: deleteOidcConfig
      tags: [SSO Admin]
      summary: Delete OIDC configuration
      description: Permanently deletes an OIDC identity provider configuration. Requires admin privileges.
      parameters:
        - name: id
          in: path
          required: true
          description: OIDC configuration UUID
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: OIDC configuration deleted
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/admin/auth/sso-admin/oidc/{id}/toggle:
    patch:
      operationId: toggleOidcConfig
      tags: [SSO Admin]
      summary: Toggle OIDC configuration
      description: Enables or disables an OIDC identity provider configuration. Requires admin privileges.
      parameters:
        - name: id
          in: path
          required: true
          description: OIDC configuration UUID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [enabled]
              properties:
                enabled:
                  type: boolean
                  description: Whether the OIDC configuration should be enabled
      responses:
        "200":
          description: OIDC configuration toggled
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OidcConfigResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/admin/auth/sso-admin/ldap:
    get:
      operationId: listLdapConfigs
      tags: [SSO Admin]
      summary: List LDAP configurations
      description: Returns all configured LDAP directory configurations. Requires admin privileges.
      responses:
        "200":
          description: List of LDAP configurations
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/LdapConfigResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/InternalServerError"

    post:
      operationId: createLdapConfig
      tags: [SSO Admin]
      summary: Create LDAP configuration
      description: Creates a new LDAP directory configuration for user authentication and group synchronization. Requires admin privileges.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateLdapConfigRequest"
      responses:
        "201":
          description: LDAP configuration created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LdapConfigResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/admin/auth/sso-admin/ldap/{id}:
    get:
      operationId: getLdapConfig
      tags: [SSO Admin]
      summary: Get LDAP configuration
      description: Returns a single LDAP directory configuration by ID. Requires admin privileges.
      parameters:
        - name: id
          in: path
          required: true
          description: LDAP configuration UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: LDAP configuration details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LdapConfigResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    put:
      operationId: updateLdapConfig
      tags: [SSO Admin]
      summary: Update LDAP configuration
      description: Replaces an existing LDAP directory configuration. Requires admin privileges.
      parameters:
        - name: id
          in: path
          required: true
          description: LDAP configuration UUID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateLdapConfigRequest"
      responses:
        "200":
          description: LDAP configuration updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LdapConfigResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"

    delete:
      operationId: deleteLdapConfig
      tags: [SSO Admin]
      summary: Delete LDAP configuration
      description: Permanently deletes an LDAP directory configuration. Requires admin privileges.
      parameters:
        - name: id
          in: path
          required: true
          description: LDAP configuration UUID
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: LDAP configuration deleted
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/admin/auth/sso-admin/ldap/{id}/toggle:
    patch:
      operationId: toggleLdapConfig
      tags: [SSO Admin]
      summary: Toggle LDAP configuration
      description: Enables or disables an LDAP directory configuration. Requires admin privileges.
      parameters:
        - name: id
          in: path
          required: true
          description: LDAP configuration UUID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [enabled]
              properties:
                enabled:
                  type: boolean
                  description: Whether the LDAP configuration should be enabled
      responses:
        "200":
          description: LDAP configuration toggled
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LdapConfigResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/admin/auth/sso-admin/ldap/{id}/test:
    post:
      operationId: testLdapConfig
      tags: [SSO Admin]
      summary: Test LDAP configuration
      description: Tests the connectivity and authentication of an LDAP directory configuration. Requires admin privileges.
      parameters:
        - name: id
          in: path
          required: true
          description: LDAP configuration UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: LDAP connectivity test result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LdapTestResult"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/admin/auth/sso-admin/saml:
    get:
      operationId: listSamlConfigs
      tags: [SSO Admin]
      summary: List SAML configurations
      description: Returns all configured SAML identity provider configurations. Requires admin privileges.
      responses:
        "200":
          description: List of SAML configurations
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/SamlConfigResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/InternalServerError"

    post:
      operationId: createSamlConfig
      tags: [SSO Admin]
      summary: Create SAML configuration
      description: Creates a new SAML identity provider configuration. Requires admin privileges.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateSamlConfigRequest"
      responses:
        "201":
          description: SAML configuration created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SamlConfigResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/admin/auth/sso-admin/saml/{id}:
    get:
      operationId: getSamlConfig
      tags: [SSO Admin]
      summary: Get SAML configuration
      description: Returns a single SAML identity provider configuration by ID. Requires admin privileges.
      parameters:
        - name: id
          in: path
          required: true
          description: SAML configuration UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: SAML configuration details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SamlConfigResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    put:
      operationId: updateSamlConfig
      tags: [SSO Admin]
      summary: Update SAML configuration
      description: Replaces an existing SAML identity provider configuration. Requires admin privileges.
      parameters:
        - name: id
          in: path
          required: true
          description: SAML configuration UUID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateSamlConfigRequest"
      responses:
        "200":
          description: SAML configuration updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SamlConfigResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"

    delete:
      operationId: deleteSamlConfig
      tags: [SSO Admin]
      summary: Delete SAML configuration
      description: Permanently deletes a SAML identity provider configuration. Requires admin privileges.
      parameters:
        - name: id
          in: path
          required: true
          description: SAML configuration UUID
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: SAML configuration deleted
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/admin/auth/sso-admin/saml/{id}/toggle:
    patch:
      operationId: toggleSamlConfig
      tags: [SSO Admin]
      summary: Toggle SAML configuration
      description: Enables or disables a SAML identity provider configuration. Requires admin privileges.
      parameters:
        - name: id
          in: path
          required: true
          description: SAML configuration UUID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [enabled]
              properties:
                enabled:
                  type: boolean
                  description: Whether the SAML configuration should be enabled
      responses:
        "200":
          description: SAML configuration toggled
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SamlConfigResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/admin/auth/sso-admin/providers:
    get:
      operationId: listSsoProviders
      tags: [SSO Admin]
      summary: List all SSO providers
      description: Returns a unified list of all configured SSO providers across OIDC, LDAP, and SAML. Requires admin privileges.
      responses:
        "200":
          description: List of all SSO providers
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/SsoProviderInfo"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/InternalServerError"

  # =============================================================================
  # SSO Public Endpoints
  # =============================================================================

  /api/v1/auth/sso/providers:
    get:
      operationId: listPublicSsoProviders
      tags: [SSO]
      summary: List available SSO providers
      description: Returns all enabled SSO providers available for authentication. This endpoint is public and does not require authentication.
      security: []
      responses:
        "200":
          description: List of available SSO providers
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/SsoProviderInfo"
        "429":
          description: Too many requests
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/auth/sso/oidc/{id}/login:
    get:
      operationId: oidcLogin
      tags: [SSO]
      summary: Initiate OIDC login
      description: Initiates the OIDC authorization code flow by redirecting the user to the identity provider's authorization endpoint.
      security: []
      parameters:
        - name: id
          in: path
          required: true
          description: OIDC configuration UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: SSO login URL (returned when Accept header is application/json)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SsoRedirectResponse"
        "302":
          description: Redirect to OIDC identity provider
          headers:
            Location:
              description: OIDC authorization endpoint URL
              schema:
                type: string
                format: uri
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/auth/sso/oidc/{id}/callback:
    get:
      operationId: oidcCallback
      tags: [SSO]
      summary: OIDC callback
      description: Handles the OIDC authorization code callback from the identity provider. Exchanges the code for tokens and redirects the user to the application with a session code.
      security: []
      parameters:
        - name: id
          in: path
          required: true
          description: OIDC configuration UUID
          schema:
            type: string
            format: uuid
        - name: code
          in: query
          required: true
          description: Authorization code from the OIDC identity provider
          schema:
            type: string
        - name: state
          in: query
          required: true
          description: OAuth state parameter for CSRF protection
          schema:
            type: string
      responses:
        "200":
          description: SSO login URL (returned when Accept header is application/json)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SsoRedirectResponse"
        "302":
          description: Redirect to application with session code
          headers:
            Location:
              description: Application callback URL with code parameter
              schema:
                type: string
                format: uri
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/auth/sso/ldap/{id}/login:
    post:
      operationId: ldapLogin
      tags: [SSO]
      summary: Authenticate via LDAP
      description: Authenticates a user against the specified LDAP directory and returns access and refresh tokens.
      security: []
      parameters:
        - name: id
          in: path
          required: true
          description: LDAP configuration UUID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [username, password]
              properties:
                username:
                  type: string
                  minLength: 1
                  description: LDAP username or distinguished name
                password:
                  type: string
                  format: password
                  minLength: 1
                  description: LDAP password
      responses:
        "200":
          description: LDAP authentication successful
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TokenPair"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/auth/sso/saml/{id}/login:
    get:
      operationId: samlLogin
      tags: [SSO]
      summary: Initiate SAML login
      description: Initiates the SAML authentication flow by redirecting the user to the identity provider's SSO endpoint with an authentication request.
      security: []
      parameters:
        - name: id
          in: path
          required: true
          description: SAML configuration UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: SSO login URL (returned when Accept header is application/json)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SsoRedirectResponse"
        "302":
          description: Redirect to SAML identity provider
          headers:
            Location:
              description: SAML identity provider SSO URL
              schema:
                type: string
                format: uri
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/auth/sso/saml/{id}/acs:
    post:
      operationId: samlAcs
      tags: [SSO]
      summary: SAML Assertion Consumer Service
      description: Handles the SAML response from the identity provider. Validates the assertion, creates or updates the user, and redirects to the application with a session code.
      security: []
      parameters:
        - name: id
          in: path
          required: true
          description: SAML configuration UUID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required: [SAMLResponse]
              properties:
                SAMLResponse:
                  type: string
                  description: Base64-encoded SAML response from the identity provider
                RelayState:
                  type: string
                  description: Optional relay state for redirect after authentication
      responses:
        "200":
          description: SSO login URL (returned when Accept header is application/json)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SsoRedirectResponse"
        "302":
          description: Redirect to application with session code
          headers:
            Location:
              description: Application callback URL with code parameter
              schema:
                type: string
                format: uri
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/auth/sso/exchange:
    post:
      operationId: exchangeSsoCode
      tags: [SSO]
      summary: Exchange SSO code for tokens
      description: Exchanges a temporary SSO authorization code (received via redirect after OIDC or SAML authentication) for access and refresh tokens.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [code]
              properties:
                code:
                  type: string
                  description: Temporary authorization code received from the SSO callback redirect
      responses:
        "200":
          description: Tokens issued successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SsoExchangeResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"
  # ---------------------------------------------------------------------------
  # Analytics
  # ---------------------------------------------------------------------------

  /api/v1/admin/analytics/storage/trend:
    get:
      operationId: getStorageTrend
      tags: [Analytics]
      summary: Get storage trend
      description: Returns a time-series of daily storage snapshots within the requested date range. Useful for charting total storage, artifact counts, and user growth over time.
      parameters:
        - name: from
          in: query
          description: Start date (inclusive) in YYYY-MM-DD format. Defaults to 30 days ago when omitted.
          schema:
            type: string
            format: date
        - name: to
          in: query
          description: End date (inclusive) in YYYY-MM-DD format. Defaults to today when omitted.
          schema:
            type: string
            format: date
      responses:
        "200":
          description: Array of daily storage snapshots.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/StorageSnapshot"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/v1/admin/analytics/storage/breakdown:
    get:
      operationId: getStorageBreakdown
      tags: [Analytics]
      summary: Get storage breakdown by repository
      description: Returns per-repository storage usage including artifact counts, byte totals, download counts, and the timestamp of the most recent upload.
      responses:
        "200":
          description: Array of per-repository storage breakdowns.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/RepositoryStorageBreakdown"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/v1/admin/analytics/storage/growth:
    get:
      operationId: getStorageGrowth
      tags: [Analytics]
      summary: Get storage growth summary
      description: Returns an aggregate growth summary comparing the start and end of the requested period, including absolute and percentage changes in storage and artifact counts.
      parameters:
        - name: from
          in: query
          description: Start date (inclusive) in YYYY-MM-DD format. Defaults to 30 days ago when omitted.
          schema:
            type: string
            format: date
        - name: to
          in: query
          description: End date (inclusive) in YYYY-MM-DD format. Defaults to today when omitted.
          schema:
            type: string
            format: date
      responses:
        "200":
          description: Growth summary for the requested period.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GrowthSummary"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/v1/admin/analytics/artifacts/stale:
    get:
      operationId: getStaleArtifacts
      tags: [Analytics]
      summary: List stale artifacts
      description: Returns artifacts that have not been downloaded within the specified number of days, ordered by staleness descending. Useful for identifying cleanup candidates.
      parameters:
        - name: days
          in: query
          description: Minimum number of days since the last download to consider an artifact stale. Defaults to 90.
          schema:
            type: integer
            minimum: 1
        - name: limit
          in: query
          description: Maximum number of stale artifacts to return. Defaults to 50.
          schema:
            type: integer
            minimum: 1
            maximum: 1000
      responses:
        "200":
          description: Array of stale artifacts.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/StaleArtifact"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/v1/admin/analytics/downloads/trend:
    get:
      operationId: getDownloadsTrend
      tags: [Analytics]
      summary: Get downloads trend
      description: Returns a daily time-series of download counts within the requested date range, suitable for charting download activity over time.
      parameters:
        - name: from
          in: query
          description: Start date (inclusive) in YYYY-MM-DD format. Defaults to 30 days ago when omitted.
          schema:
            type: string
            format: date
        - name: to
          in: query
          description: End date (inclusive) in YYYY-MM-DD format. Defaults to today when omitted.
          schema:
            type: string
            format: date
      responses:
        "200":
          description: Array of daily download counts.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/DownloadTrend"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/v1/admin/analytics/repositories/{id}/trend:
    parameters:
      - name: id
        in: path
        required: true
        description: Repository UUID.
        schema:
          type: string
          format: uuid
    get:
      operationId: getRepositoryTrend
      tags: [Analytics]
      summary: Get repository trend
      description: Returns a daily time-series of snapshots for a single repository within the requested date range, including artifact counts, storage bytes, and download counts.
      parameters:
        - name: from
          in: query
          description: Start date (inclusive) in YYYY-MM-DD format. Defaults to 30 days ago when omitted.
          schema:
            type: string
            format: date
        - name: to
          in: query
          description: End date (inclusive) in YYYY-MM-DD format. Defaults to today when omitted.
          schema:
            type: string
            format: date
      responses:
        "200":
          description: Array of daily repository snapshots.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/RepositorySnapshot"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/admin/analytics/snapshot:
    post:
      operationId: captureAnalyticsSnapshot
      tags: [Analytics]
      summary: Capture analytics snapshot
      description: Captures a point-in-time snapshot of the current system state including repository, artifact, storage, download, and user totals. The snapshot is persisted and returned.
      responses:
        "201":
          description: Snapshot captured successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StorageSnapshot"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  # ---------------------------------------------------------------------------
  # Monitoring
  # ---------------------------------------------------------------------------

  /api/v1/admin/monitoring/health-log:
    get:
      operationId: getHealthLog
      tags: [Monitoring]
      summary: Get health check log
      description: Returns recent health check entries, optionally filtered by service name. Each entry captures the result of a periodic health probe including status, response time, and any error messages.
      parameters:
        - name: service
          in: query
          description: Filter entries to a specific service name (e.g. "database", "storage", "meilisearch").
          schema:
            type: string
        - name: limit
          in: query
          description: Maximum number of entries to return. Defaults to 100.
          schema:
            type: integer
            minimum: 1
            maximum: 1000
      responses:
        "200":
          description: Array of health check log entries.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ServiceHealthEntry"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/v1/admin/monitoring/alerts:
    get:
      operationId: getAlertStates
      tags: [Monitoring]
      summary: Get alert states
      description: Returns the current alert state for every monitored service, including consecutive failure counts, last alert timestamp, and suppression windows.
      responses:
        "200":
          description: Array of service alert states.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/AlertState"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/v1/admin/monitoring/alerts/suppress:
    post:
      operationId: suppressAlert
      tags: [Monitoring]
      summary: Suppress alerts for a service
      description: Suppresses alert notifications for the specified service until the given timestamp. Existing alerts are not cleared, but no new notifications will be sent until the suppression window expires.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [service_name, until]
              properties:
                service_name:
                  type: string
                  description: Name of the service whose alerts should be suppressed.
                  example: database
                until:
                  type: string
                  format: date-time
                  description: Suppress alerts until this timestamp (ISO 8601).
                  example: "2026-02-08T12:00:00Z"
      responses:
        "200":
          description: Updated alert state with the suppression window applied.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AlertState"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/admin/monitoring/check:
    post:
      operationId: runHealthCheck
      tags: [Monitoring]
      summary: Run immediate health check
      description: Triggers an immediate health check against all monitored services and returns the results. This bypasses the normal polling interval and records the results in the health log.
      responses:
        "200":
          description: Health check results for all monitored services.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ServiceHealthEntry"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
  /api/v1/admin/telemetry/settings:
    get:
      operationId: getTelemetrySettings
      tags:
        - Telemetry
      summary: Get telemetry settings
      description: Retrieve the current telemetry configuration including data collection preferences and scrubbing levels.
      responses:
        "200":
          description: Current telemetry settings.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TelemetrySettings"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/InternalServerError"
    post:
      operationId: updateTelemetrySettings
      tags:
        - Telemetry
      summary: Update telemetry settings
      description: Replace the current telemetry configuration with the provided settings.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TelemetrySettings"
      responses:
        "200":
          description: Updated telemetry settings.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TelemetrySettings"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "422":
          $ref: "#/components/responses/UnprocessableEntity"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/admin/telemetry/crashes:
    get:
      operationId: listCrashReports
      tags:
        - Telemetry
      summary: List crash reports
      description: Retrieve a paginated list of crash reports ordered by most recent occurrence.
      parameters:
        - name: page
          in: query
          required: false
          description: Page number for pagination (1-indexed).
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: per_page
          in: query
          required: false
          description: Number of items per page.
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
      responses:
        "200":
          description: Paginated list of crash reports.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CrashListResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/admin/telemetry/crashes/pending:
    get:
      operationId: listPendingCrashReports
      tags:
        - Telemetry
      summary: List pending crash reports
      description: Retrieve all crash reports that have not yet been submitted for review.
      responses:
        "200":
          description: List of pending crash reports.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/CrashReport"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/admin/telemetry/crashes/{id}:
    get:
      operationId: getCrashReport
      tags:
        - Telemetry
      summary: Get a crash report
      description: Retrieve a single crash report by its unique identifier.
      parameters:
        - name: id
          in: path
          required: true
          description: Unique identifier of the crash report.
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: The requested crash report.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CrashReport"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"
    delete:
      operationId: deleteCrashReport
      tags:
        - Telemetry
      summary: Delete a crash report
      description: Permanently remove a crash report from the system.
      parameters:
        - name: id
          in: path
          required: true
          description: Unique identifier of the crash report to delete.
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: Crash report deleted successfully.
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/admin/telemetry/crashes/submit:
    post:
      operationId: submitCrashReports
      tags:
        - Telemetry
      summary: Submit crash reports
      description: Mark the specified crash reports as submitted to the telemetry service.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - ids
              properties:
                ids:
                  type: array
                  description: List of crash report identifiers to submit.
                  items:
                    type: string
                    format: uuid
      responses:
        "200":
          description: Number of crash reports marked as submitted.
          content:
            application/json:
              schema:
                type: object
                required:
                  - marked_submitted
                properties:
                  marked_submitted:
                    type: integer
                    description: Count of crash reports that were marked as submitted.
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "422":
          $ref: "#/components/responses/UnprocessableEntity"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/admin/lifecycle:
    get:
      operationId: listLifecyclePolicies
      tags:
        - Lifecycle
      summary: List lifecycle policies
      description: Retrieve all lifecycle policies, optionally filtered by repository.
      parameters:
        - name: repository_id
          in: query
          required: false
          description: Filter policies by repository identifier.
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: List of lifecycle policies.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/LifecyclePolicy"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/InternalServerError"
    post:
      operationId: createLifecyclePolicy
      tags:
        - Lifecycle
      summary: Create a lifecycle policy
      description: Create a new lifecycle policy for automated artifact retention and cleanup.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - policy_type
                - config
              properties:
                repository_id:
                  type: [string, "null"]
                  format: uuid
                  description: Repository to scope this policy to. When null the policy applies globally.
                name:
                  type: string
                  description: Human-readable name for the policy.
                description:
                  type: [string, "null"]
                  description: Optional longer description of the policy purpose.
                policy_type:
                  type: string
                  description: Type of lifecycle policy (e.g. retention, cleanup, archive).
                config:
                  type: object
                  description: Policy-type-specific configuration object.
                priority:
                  type: [integer, "null"]
                  description: Execution priority. Lower values execute first.
      responses:
        "201":
          description: Lifecycle policy created successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LifecyclePolicy"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "409":
          $ref: "#/components/responses/Conflict"
        "422":
          $ref: "#/components/responses/UnprocessableEntity"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/admin/lifecycle/{id}:
    get:
      operationId: getLifecyclePolicy
      tags:
        - Lifecycle
      summary: Get a lifecycle policy
      description: Retrieve a single lifecycle policy by its unique identifier.
      parameters:
        - name: id
          in: path
          required: true
          description: Unique identifier of the lifecycle policy.
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: The requested lifecycle policy.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LifecyclePolicy"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"
    patch:
      operationId: updateLifecyclePolicy
      tags:
        - Lifecycle
      summary: Update a lifecycle policy
      description: Partially update an existing lifecycle policy. Only provided fields are modified.
      parameters:
        - name: id
          in: path
          required: true
          description: Unique identifier of the lifecycle policy to update.
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: [string, "null"]
                  description: Updated human-readable name for the policy.
                description:
                  type: [string, "null"]
                  description: Updated description of the policy purpose.
                enabled:
                  type: [boolean, "null"]
                  description: Whether the policy is enabled for scheduled execution.
                config:
                  type: [object, "null"]
                  description: Updated policy-type-specific configuration object.
                priority:
                  type: [integer, "null"]
                  description: Updated execution priority.
      responses:
        "200":
          description: Updated lifecycle policy.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LifecyclePolicy"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "422":
          $ref: "#/components/responses/UnprocessableEntity"
        "500":
          $ref: "#/components/responses/InternalServerError"
    delete:
      operationId: deleteLifecyclePolicy
      tags:
        - Lifecycle
      summary: Delete a lifecycle policy
      description: Permanently remove a lifecycle policy. Running executions are not affected.
      parameters:
        - name: id
          in: path
          required: true
          description: Unique identifier of the lifecycle policy to delete.
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: Lifecycle policy deleted successfully.
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/admin/lifecycle/{id}/execute:
    post:
      operationId: executeLifecyclePolicy
      tags:
        - Lifecycle
      summary: Execute a lifecycle policy
      description: Trigger an immediate execution of the specified lifecycle policy. Matched artifacts will be permanently removed.
      parameters:
        - name: id
          in: path
          required: true
          description: Unique identifier of the lifecycle policy to execute.
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Result of the policy execution.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PolicyExecutionResult"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/admin/lifecycle/{id}/preview:
    post:
      operationId: previewLifecyclePolicy
      tags:
        - Lifecycle
      summary: Preview a lifecycle policy
      description: Perform a dry-run execution of the specified lifecycle policy. No artifacts are modified or removed.
      parameters:
        - name: id
          in: path
          required: true
          description: Unique identifier of the lifecycle policy to preview.
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Dry-run result showing what the policy would affect.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PolicyExecutionResult"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/admin/lifecycle/execute-all:
    post:
      operationId: executeAllLifecyclePolicies
      tags:
        - Lifecycle
      summary: Execute all enabled lifecycle policies
      description: Trigger an immediate execution of every enabled lifecycle policy in priority order. Matched artifacts will be permanently removed.
      responses:
        "200":
          description: Results of each policy execution.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/PolicyExecutionResult"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/InternalServerError"



components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    apiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key

  parameters:
    page:
      name: page
      in: query
      description: Page number for pagination
      required: false
      schema:
        type: integer
        default: 1
        minimum: 1
    perPage:
      name: per_page
      in: query
      description: Number of items per page
      required: false
      schema:
        type: integer
        default: 20
        minimum: 1
        maximum: 100
  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Forbidden:
      description: Forbidden
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    NotFound:
      description: Not found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Conflict:
      description: Conflict
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    UnprocessableEntity:
      description: Unprocessable entity
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"

    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"

  schemas:

    SsoRedirectResponse:
      type: object
      properties:
        redirect_url:
          type: string
          format: uri

    AsyncTaskResponse:
      type: object
      required:
        - task_id
        - status
      properties:
        task_id:
          type: string
          format: uuid
        status:
          type: string
          example: started

    TestResultResponse:
      type: object
      required:
        - success
        - message
      properties:
        success:
          type: boolean
        message:
          type: string

    SigningRepositoryConfig:
      type: object
      properties:
        enabled:
          type: boolean
        key_id:
          type: string
          format: uuid
        sign_metadata:
          type: boolean
        sign_packages:
          type: boolean

    GroupMembersRequest:
      type: object
      required:
        - user_ids
      properties:
        user_ids:
          type: array
          items:
            type: string
            format: uuid
          minItems: 1

    AuditLogEntry:
      type: object
      required:
        - id
        - user_id
        - action
        - timestamp
      properties:
        id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        username:
          type: string
        action:
          type: string
        resource_type:
          type: string
        resource_id:
          type: string
        details:
          type: object
          additionalProperties: true
        ip_address:
          type: string
        timestamp:
          type: string
          format: date-time

    ErrorResponse:
      type: object
      required:
        - error
      properties:
        error:
          type: string
        details:
          type: object

    ComponentHealth:
      type: object
      required:
        - status
      properties:
        status:
          type: string
          enum:
            - healthy
            - degraded
            - unhealthy
        latency_ms:
          type:
            - integer
            - "null"
          description: Response time in milliseconds

    TokenPair:
      type: object
      required:
        - access_token
        - refresh_token
        - token_type
        - expires_in
      properties:
        access_token:
          type: string
        refresh_token:
          type: string
        token_type:
          type: string
          enum:
            - Bearer
        expires_in:
          type: integer
          description: Token lifetime in seconds

    Pagination:
      type: object
      required:
        - page
        - per_page
        - total_items
        - total_pages
      properties:
        page:
          type: integer
        per_page:
          type: integer
        total_items:
          type: integer
        total_pages:
          type: integer

    User:
      type: object
      required:
        - id
        - username
        - email
        - is_active
        - is_admin
        - created_at
        - updated_at
      properties:
        id:
          type: string
          format: uuid
        username:
          type: string
        email:
          type: string
        display_name:
          type:
            - string
            - "null"
        is_active:
          type: boolean
        is_admin:
          type: boolean
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    Role:
      type: object
      required:
        - id
        - name
        - permissions
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type:
            - string
            - "null"
        permissions:
          type: array
          items:
            type: string

    ApiToken:
      type: object
      required:
        - id
        - name
        - created_at
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        scopes:
          type:
            - array
            - "null"
          items:
            type: string
        expires_at:
          type:
            - string
            - "null"
          format: date-time
        last_used_at:
          type:
            - string
            - "null"
          format: date-time
        created_at:
          type: string
          format: date-time

    Repository:
      type: object
      required:
        - id
        - key
        - name
        - format
        - type
        - is_public
        - used_bytes
        - artifact_count
        - created_at
        - updated_at
      properties:
        id:
          type: string
          format: uuid
        key:
          type: string
          description: Unique slug identifier
        name:
          type: string
        format:
          type: string
          enum:
            - maven
            - npm
            - pypi
            - nuget
            - cargo
            - go
            - docker
            - helm
            - debian
            - rpm
            - rubygems
            - conan
            - composer
            - alpine
            - conda
            - terraform
            - generic
        type:
          type: string
          enum:
            - local
            - remote
            - virtual
        description:
          type:
            - string
            - "null"
        is_public:
          type: boolean
        quota_bytes:
          type:
            - integer
            - "null"
        used_bytes:
          type: integer
        artifact_count:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    Artifact:
      type: object
      required:
        - id
        - repository_id
        - repository_key
        - path
        - name
        - format
        - size_bytes
        - sha256
        - content_type
        - download_count
        - created_at
        - updated_at
      properties:
        id:
          type: string
          format: uuid
        repository_id:
          type: string
          format: uuid
        repository_key:
          type: string
        path:
          type: string
        name:
          type: string
        version:
          type:
            - string
            - "null"
        format:
          type: string
        size_bytes:
          type: integer
        sha256:
          type: string
        content_type:
          type: string
        download_count:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    SearchResult:
      type: object
      required:
        - id
        - name
        - path
        - format
        - repository_key
        - size_bytes
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        path:
          type: string
        version:
          type:
            - string
            - "null"
        format:
          type: string
        repository_key:
          type: string
        size_bytes:
          type: integer
        highlight:
          type:
            - object
            - "null"
          description: Matched fields from the search query

    Group:
      type: object
      required:
        - id
        - name
        - member_count
        - created_at
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type:
            - string
            - "null"
        member_count:
          type: integer
        created_at:
          type: string
          format: date-time

    Permission:
      type: object
      required:
        - id
        - name
        - resource_type
        - actions
        - principal_type
        - principal_id
        - created_at
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        resource_type:
          type: string
          enum:
            - repository
            - system
        resource_id:
          type:
            - string
            - "null"
          format: uuid
        actions:
          type: array
          items:
            type: string
            enum:
              - read
              - write
              - delete
              - admin
        principal_type:
          type: string
          enum:
            - user
            - group
        principal_id:
          type: string
          format: uuid
        created_at:
          type: string
          format: date-time

    Webhook:
      type: object
      required:
        - id
        - url
        - events
        - is_enabled
        - created_at
      properties:
        id:
          type: string
          format: uuid
        url:
          type: string
          format: uri
        events:
          type: array
          items:
            type: string
            enum:
              - artifact_uploaded
              - artifact_deleted
              - repository_created
              - repository_deleted
              - user_created
              - user_deleted
              - build_started
              - build_completed
              - build_failed
        repository_id:
          type:
            - string
            - "null"
          format: uuid
        is_enabled:
          type: boolean
        last_triggered_at:
          type:
            - string
            - "null"
          format: date-time
        created_at:
          type: string
          format: date-time

    WebhookDelivery:
      type: object
      required:
        - id
        - webhook_id
        - event
        - request_body
        - delivered_at
        - success
      properties:
        id:
          type: string
          format: uuid
        webhook_id:
          type: string
          format: uuid
        event:
          type: string
        status_code:
          type:
            - integer
            - "null"
        request_body:
          type: string
        response_body:
          type:
            - string
            - "null"
        delivered_at:
          type: string
          format: date-time
        success:
          type: boolean

    Plugin:
      type: object
      required:
        - id
        - name
        - version
        - status
        - source_type
        - installed_at
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        version:
          type: string
        description:
          type:
            - string
            - "null"
        author:
          type:
            - string
            - "null"
        license:
          type:
            - string
            - "null"
        status:
          type: string
          enum:
            - active
            - disabled
            - error
        source_type:
          type: string
          enum:
            - core
            - wasm_git
            - wasm_zip
            - wasm_local
        source_url:
          type:
            - string
            - "null"
        format_key:
          type:
            - string
            - "null"
        capabilities:
          type:
            - object
            - "null"
        resource_limits:
          type:
            - object
            - "null"
        installed_at:
          type: string
          format: date-time

    PluginEvent:
      type: object
      required:
        - id
        - plugin_id
        - event_type
        - message
        - created_at
      properties:
        id:
          type: string
          format: uuid
        plugin_id:
          type: string
          format: uuid
        event_type:
          type: string
        message:
          type: string
        created_at:
          type: string
          format: date-time

    FormatHandler:
      type: object
      required:
        - id
        - format_key
        - handler_type
        - display_name
        - extensions
        - is_enabled
      properties:
        id:
          type: string
          format: uuid
        format_key:
          type: string
        handler_type:
          type: string
          enum:
            - core
            - wasm
        display_name:
          type: string
        description:
          type:
            - string
            - "null"
        extensions:
          type: array
          items:
            type: string
        is_enabled:
          type: boolean
        plugin_id:
          type:
            - string
            - "null"
          format: uuid

    SigningKey:
      type: object
      required:
        - id
        - name
        - key_type
        - fingerprint
        - status
        - created_at
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        key_type:
          type: string
          enum:
            - rsa
            - gpg
        fingerprint:
          type: string
        repository_id:
          type:
            - string
            - "null"
          format: uuid
        status:
          type: string
          enum:
            - active
            - revoked
        created_at:
          type: string
          format: date-time
        expires_at:
          type:
            - string
            - "null"
          format: date-time

    SecurityScore:
      type: object
      required:
        - repository_id
        - repository_key
        - score
        - critical_count
        - high_count
        - medium_count
        - low_count
      properties:
        repository_id:
          type: string
          format: uuid
        repository_key:
          type: string
        score:
          type: string
          enum:
            - A
            - B
            - C
            - D
            - F
        critical_count:
          type: integer
        high_count:
          type: integer
        medium_count:
          type: integer
        low_count:
          type: integer
        last_scanned_at:
          type:
            - string
            - "null"
          format: date-time

    Scan:
      type: object
      required:
        - id
        - scanner
        - status
        - findings_count
        - created_at
      properties:
        id:
          type: string
          format: uuid
        artifact_id:
          type:
            - string
            - "null"
          format: uuid
        repository_id:
          type:
            - string
            - "null"
          format: uuid
        scanner:
          type: string
          enum:
            - trivy
            - grype
        status:
          type: string
          enum:
            - pending
            - running
            - completed
            - failed
        findings_count:
          type: integer
        started_at:
          type:
            - string
            - "null"
          format: date-time
        completed_at:
          type:
            - string
            - "null"
          format: date-time
        created_at:
          type: string
          format: date-time

    Finding:
      type: object
      required:
        - id
        - scan_id
        - vulnerability_id
        - severity
        - package_name
        - installed_version
        - title
        - acknowledged
      properties:
        id:
          type: string
          format: uuid
        scan_id:
          type: string
          format: uuid
        vulnerability_id:
          type: string
          description: CVE identifier
        severity:
          type: string
          enum:
            - critical
            - high
            - medium
            - low
            - negligible
        package_name:
          type: string
        installed_version:
          type: string
        fixed_version:
          type:
            - string
            - "null"
        title:
          type: string
        description:
          type:
            - string
            - "null"
        acknowledged:
          type: boolean
        acknowledged_by:
          type:
            - string
            - "null"
          format: uuid
        acknowledged_reason:
          type:
            - string
            - "null"

    SecurityPolicy:
      type: object
      required:
        - id
        - name
        - rules
        - is_enabled
        - created_at
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        rules:
          type: object
          description: "Policy rules, e.g. { block_severity: [\"critical\"], quarantine_severity: [\"high\"] }"
        repository_id:
          type:
            - string
            - "null"
          format: uuid
        is_enabled:
          type: boolean
        created_at:
          type: string
          format: date-time

    EdgeNode:
      type: object
      required:
        - id
        - name
        - region
        - url
        - status
        - cache_size_mb
        - capacity_mb
        - repositories
        - created_at
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        region:
          type: string
        url:
          type: string
          format: uri
        status:
          type: string
          enum:
            - healthy
            - degraded
            - offline
        cache_size_mb:
          type: integer
        capacity_mb:
          type: integer
        last_heartbeat:
          type:
            - string
            - "null"
          format: date-time
        repositories:
          type: array
          items:
            type: string
          description: Repository keys assigned to this edge node
        created_at:
          type: string
          format: date-time

    TransferSession:
      type: object
      required:
        - id
        - artifact_id
        - source_node_id
        - status
        - total_chunks
        - completed_chunks
        - total_bytes
        - transferred_bytes
        - created_at
      properties:
        id:
          type: string
          format: uuid
        artifact_id:
          type: string
          format: uuid
        source_node_id:
          type: string
          format: uuid
        target_node_id:
          type:
            - string
            - "null"
          format: uuid
        status:
          type: string
          enum:
            - pending
            - transferring
            - completed
            - failed
        total_chunks:
          type: integer
        completed_chunks:
          type: integer
        total_bytes:
          type: integer
        transferred_bytes:
          type: integer
        created_at:
          type: string
          format: date-time

    PeerConnection:
      type: object
      required:
        - id
        - node_id
        - peer_node_id
        - status
      properties:
        id:
          type: string
          format: uuid
        node_id:
          type: string
          format: uuid
        peer_node_id:
          type: string
          format: uuid
        latency_ms:
          type:
            - integer
            - "null"
        bandwidth_mbps:
          type:
            - number
            - "null"
        status:
          type: string
          enum:
            - connected
            - disconnected

    ScoredPeer:
      type: object
      required:
        - node_id
        - score
        - latency_ms
        - bandwidth_mbps
        - has_chunks
      properties:
        node_id:
          type: string
          format: uuid
        score:
          type: number
        latency_ms:
          type: integer
        bandwidth_mbps:
          type: number
        has_chunks:
          type: integer

    NetworkProfile:
      type: object
      required:
        - node_id
        - upload_bandwidth_mbps
        - download_bandwidth_mbps
        - max_concurrent_transfers
      properties:
        node_id:
          type: string
          format: uuid
        upload_bandwidth_mbps:
          type: number
        download_bandwidth_mbps:
          type: number
        max_concurrent_transfers:
          type: integer

    Backup:
      type: object
      required:
        - id
        - type
        - status
        - include_artifacts
        - created_at
      properties:
        id:
          type: string
          format: uuid
        type:
          type: string
          enum:
            - full
            - metadata
            - incremental
        status:
          type: string
          enum:
            - pending
            - running
            - completed
            - failed
        size_bytes:
          type:
            - integer
            - "null"
        include_artifacts:
          type: boolean
        created_at:
          type: string
          format: date-time
        completed_at:
          type:
            - string
            - "null"
          format: date-time

    SystemSettings:
      type: object
      additionalProperties: true
      description: Key-value settings map

    MigrationConnection:
      type: object
      required:
        - id
        - name
        - url
        - username
        - type
        - verified
        - created_at
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        url:
          type: string
          format: uri
        username:
          type: string
        type:
          type: string
          enum:
            - artifactory
            - nexus
        verified:
          type: boolean
        created_at:
          type: string
          format: date-time

    MigrationJob:
      type: object
      required:
        - id
        - connection_id
        - status
        - source_repos
        - target_repos
        - total_items
        - completed_items
        - failed_items
        - skipped_items
        - options
        - created_at
      properties:
        id:
          type: string
          format: uuid
        connection_id:
          type: string
          format: uuid
        status:
          type: string
          enum:
            - pending
            - running
            - paused
            - completed
            - failed
            - cancelled
        source_repos:
          type: array
          items:
            type: string
        target_repos:
          type: array
          items:
            type: string
        total_items:
          type: integer
        completed_items:
          type: integer
        failed_items:
          type: integer
        skipped_items:
          type: integer
        options:
          type: object
        created_at:
          type: string
          format: date-time
        started_at:
          type:
            - string
            - "null"
          format: date-time
        completed_at:
          type:
            - string
            - "null"
          format: date-time

    MigrationItem:
      type: object
      required:
        - id
        - job_id
        - source_path
        - target_path
        - status
        - size_bytes
      properties:
        id:
          type: string
          format: uuid
        job_id:
          type: string
          format: uuid
        source_path:
          type: string
        target_path:
          type: string
        status:
          type: string
          enum:
            - pending
            - transferring
            - completed
            - failed
            - skipped
        size_bytes:
          type: integer
        error_message:
          type:
            - string
            - "null"

    MigrationReport:
      type: object
      required:
        - job_id
        - total_items
        - completed_items
        - failed_items
        - skipped_items
        - total_bytes
        - transferred_bytes
        - duration_seconds
        - errors
      properties:
        job_id:
          type: string
          format: uuid
        total_items:
          type: integer
        completed_items:
          type: integer
        failed_items:
          type: integer
        skipped_items:
          type: integer
        total_bytes:
          type: integer
        transferred_bytes:
          type: integer
        duration_seconds:
          type: integer
        errors:
          type: array
          items:
            type: object

    MigrationAssessment:
      type: object
      required:
        - job_id
        - total_artifacts
        - total_size_bytes
        - format_breakdown
        - estimated_duration_seconds
        - warnings
      properties:
        job_id:
          type: string
          format: uuid
        total_artifacts:
          type: integer
        total_size_bytes:
          type: integer
        format_breakdown:
          type: object
          description: Map of format name to artifact count
          additionalProperties:
            type: integer
        estimated_duration_seconds:
          type: integer
        warnings:
          type: array
          items:
            type: string

    Build:
      type: object
      required:
        - id
        - number
        - name
        - status
        - created_at
      properties:
        id:
          type: string
          format: uuid
        number:
          type: integer
        name:
          type: string
        status:
          type: string
          enum:
            - pending
            - running
            - success
            - failed
        created_at:
          type: string
          format: date-time

    Package:
      type: object
      required:
        - id
        - name
        - repository_id
        - repository_key
        - format
        - version_count
        - total_downloads
        - created_at
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        repository_id:
          type: string
          format: uuid
        repository_key:
          type: string
        format:
          type: string
        latest_version:
          type:
            - string
            - "null"
        version_count:
          type: integer
        total_downloads:
          type: integer
        created_at:
          type: string
          format: date-time

    PackageVersion:
      type: object
      required:
        - version
        - artifact_id
        - size_bytes
        - download_count
        - published_at
      properties:
        version:
          type: string
        artifact_id:
          type: string
          format: uuid
        size_bytes:
          type: integer
        download_count:
          type: integer
        published_at:
          type: string
          format: date-time

    TreeNode:
      type: object
      required:
        - name
        - path
        - type
      properties:
        name:
          type: string
        path:
          type: string
        type:
          type: string
          enum:
            - file
            - directory
        size_bytes:
          type:
            - integer
            - "null"
          description: Size in bytes; null for directories
        children:
          type:
            - array
            - "null"
          items:
            $ref: "#/components/schemas/TreeNode"

    ChunkManifest:
      type: object
      required:
        - session_id
        - total_chunks
        - chunk_size_bytes
        - chunks
      properties:
        session_id:
          type: string
          format: uuid
        total_chunks:
          type: integer
        chunk_size_bytes:
          type: integer
        chunks:
          type: array
          items:
            type: object
            required:
              - index
              - offset
              - size
              - sha256
              - status
            properties:
              index:
                type: integer
              offset:
                type: integer
              size:
                type: integer
              sha256:
                type: string
              status:
                type: string

    SyncTask:
      type: object
      required:
        - id
        - edge_node_id
        - artifact_id
        - status
        - created_at
      properties:
        id:
          type: string
          format: uuid
        edge_node_id:
          type: string
          format: uuid
        artifact_id:
          type: string
          format: uuid
        status:
          type: string
          enum:
            - pending
            - syncing
            - completed
            - failed
        created_at:
          type: string
          format: date-time

    RemoteRepository:
      type: object
      required:
        - key
        - format
        - package_type
        - artifact_count
        - size_bytes
      properties:
        key:
          type: string
        format:
          type: string
        package_type:
          type: string
        artifact_count:
          type: integer
        size_bytes:
          type: integer


    SbomResponse:
      type: object
      required:
        - id
        - artifact_id
        - repository_id
        - format
        - format_version
        - component_count
        - dependency_count
        - license_count
        - licenses
        - content_hash
        - generated_at
        - created_at
      properties:
        id:
          type: string
          format: uuid
        artifact_id:
          type: string
          format: uuid
        repository_id:
          type: string
          format: uuid
        format:
          type: string
          description: SBOM format identifier (e.g. cyclonedx, spdx).
        format_version:
          type: string
          description: Version of the SBOM format specification used.
        spec_version:
          type:
            - string
            - "null"
          description: Specification version string embedded in the SBOM document.
        component_count:
          type: integer
          description: Number of components declared in the SBOM.
        dependency_count:
          type: integer
          description: Number of dependency relationships in the SBOM.
        license_count:
          type: integer
          description: Number of distinct licenses found across all components.
        licenses:
          type: array
          items:
            type: string
          description: Distinct SPDX license identifiers found in the SBOM.
        content_hash:
          type: string
          description: SHA-256 hash of the raw SBOM content for integrity verification.
        generator:
          type:
            - string
            - "null"
          description: Name of the tool that produced the SBOM.
        generator_version:
          type:
            - string
            - "null"
          description: Version of the generator tool.
        generated_at:
          type: string
          format: date-time
          description: Timestamp when the SBOM was generated.
        created_at:
          type: string
          format: date-time

    SbomContentResponse:
      description: Full SBOM including raw document content.
      allOf:
        - $ref: "#/components/schemas/SbomResponse"
        - type: object
          required:
            - content
          properties:
            content:
              type: object
              additionalProperties: true
              description: The raw SBOM document as free-form JSON.

    ComponentResponse:
      type: object
      required:
        - id
        - sbom_id
        - name
        - licenses
      properties:
        id:
          type: string
          format: uuid
        sbom_id:
          type: string
          format: uuid
        name:
          type: string
          description: Component name.
        version:
          type:
            - string
            - "null"
          description: Component version string.
        purl:
          type:
            - string
            - "null"
          description: Package URL (purl) identifier.
        cpe:
          type:
            - string
            - "null"
          description: Common Platform Enumeration identifier.
        component_type:
          type:
            - string
            - "null"
          description: Component type (e.g. library, framework, application).
        licenses:
          type: array
          items:
            type: string
          description: SPDX license identifiers associated with this component.
        sha256:
          type:
            - string
            - "null"
          description: SHA-256 checksum of the component artifact.
        sha1:
          type:
            - string
            - "null"
          description: SHA-1 checksum of the component artifact.
        md5:
          type:
            - string
            - "null"
          description: MD5 checksum of the component artifact.
        supplier:
          type:
            - string
            - "null"
          description: Organisation or individual that supplied the component.
        author:
          type:
            - string
            - "null"
          description: Author of the component.

    CveHistoryEntry:
      type: object
      required:
        - id
        - artifact_id
        - cve_id
        - first_detected_at
        - last_detected_at
        - status
        - created_at
        - updated_at
      properties:
        id:
          type: string
          format: uuid
        artifact_id:
          type: string
          format: uuid
        sbom_id:
          type:
            - string
            - "null"
          format: uuid
          description: SBOM in which the CVE was detected.
        component_id:
          type:
            - string
            - "null"
          format: uuid
          description: SBOM component associated with the CVE.
        scan_result_id:
          type:
            - string
            - "null"
          format: uuid
          description: Security scan result that surfaced this CVE.
        cve_id:
          type: string
          description: CVE identifier (e.g. CVE-2024-1234).
        affected_component:
          type:
            - string
            - "null"
          description: Name of the affected software component.
        affected_version:
          type:
            - string
            - "null"
          description: Version range affected by the CVE.
        fixed_version:
          type:
            - string
            - "null"
          description: Earliest version that contains the fix.
        severity:
          type:
            - string
            - "null"
          description: Severity level (e.g. critical, high, medium, low).
        cvss_score:
          type:
            - number
            - "null"
          description: CVSS score (0.0 - 10.0).
        cve_published_at:
          type:
            - string
            - "null"
          format: date-time
          description: Date the CVE was publicly disclosed.
        first_detected_at:
          type: string
          format: date-time
          description: Timestamp when this CVE was first detected for the artifact.
        last_detected_at:
          type: string
          format: date-time
          description: Timestamp of the most recent scan that detected this CVE.
        status:
          type: string
          description: Current triage status (e.g. open, acknowledged, mitigated, false_positive).
        acknowledged_by:
          type:
            - string
            - "null"
          format: uuid
          description: User who acknowledged or triaged this CVE.
        acknowledged_at:
          type:
            - string
            - "null"
          format: date-time
          description: Timestamp when the CVE was acknowledged.
        acknowledged_reason:
          type:
            - string
            - "null"
          description: Reason provided when the CVE status was changed.
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    LicensePolicyResponse:
      type: object
      required:
        - id
        - name
        - allowed_licenses
        - denied_licenses
        - allow_unknown
        - action
        - is_enabled
        - created_at
      properties:
        id:
          type: string
          format: uuid
        repository_id:
          type:
            - string
            - "null"
          format: uuid
          description: Repository this policy is scoped to. Null for global policies.
        name:
          type: string
          description: Human-readable policy name.
        description:
          type:
            - string
            - "null"
          description: Optional description of the policy intent.
        allowed_licenses:
          type: array
          items:
            type: string
          description: SPDX license identifiers that are explicitly permitted.
        denied_licenses:
          type: array
          items:
            type: string
          description: SPDX license identifiers that are explicitly prohibited.
        allow_unknown:
          type: boolean
          description: Whether artifacts with unrecognised licenses are permitted.
        action:
          type: string
          description: Enforcement action on violation (e.g. warn, block).
        is_enabled:
          type: boolean
          description: Whether the policy is currently active.
        created_at:
          type: string
          format: date-time
        updated_at:
          type:
            - string
            - "null"
          format: date-time

    LicenseCheckResult:
      type: object
      required:
        - compliant
        - violations
      properties:
        compliant:
          type: boolean
          description: Whether all provided licenses pass active policies.
        violations:
          type: array
          description: List of policy violations found, empty when compliant.
          items:
            type: object
            required:
              - license
              - policy_name
              - action
            properties:
              license:
                type: string
                description: SPDX identifier of the violating license.
              policy_name:
                type: string
                description: Name of the policy that was violated.
              action:
                type: string
                description: Enforcement action prescribed by the policy (e.g. warn, block).

    PromotionResponse:
      type: object
      required:
        - promoted
        - source
        - target
        - policy_violations
      properties:
        promoted:
          type: boolean
          description: Whether the artifact was successfully promoted.
        source:
          type: string
          description: Source repository key.
        target:
          type: string
          description: Target repository key.
        promotion_id:
          type:
            - string
            - "null"
          format: uuid
          description: ID of the promotion record, null if promotion was blocked.
        policy_violations:
          type: array
          description: Promotion policy violations detected, empty when none.
          items:
            $ref: "#/components/schemas/PolicyViolation"
        message:
          type:
            - string
            - "null"
          description: Human-readable status or error message.

    PolicyViolation:
      type: object
      required:
        - rule
        - severity
        - message
      properties:
        rule:
          type: string
          description: Name of the promotion policy rule that was violated.
        severity:
          type: string
          description: Severity of the violation (e.g. error, warning).
        message:
          type: string
          description: Detailed description of the violation.

    BulkPromotionResponse:
      type: object
      required:
        - total
        - promoted
        - failed
        - results
      properties:
        total:
          type: integer
          description: Total number of artifacts in the promotion request.
        promoted:
          type: integer
          description: Number of artifacts successfully promoted.
        failed:
          type: integer
          description: Number of artifacts that failed promotion.
        results:
          type: array
          description: Per-artifact promotion results.
          items:
            $ref: "#/components/schemas/PromotionResponse"

    PromotionHistoryEntry:
      type: object
      required:
        - id
        - artifact_id
        - artifact_path
        - source_repo_key
        - target_repo_key
        - created_at
      properties:
        id:
          type: string
          format: uuid
        artifact_id:
          type: string
          format: uuid
        artifact_path:
          type: string
          description: Path of the artifact at the time of promotion.
        source_repo_key:
          type: string
          description: Repository key the artifact was promoted from.
        target_repo_key:
          type: string
          description: Repository key the artifact was promoted to.
        promoted_by:
          type:
            - string
            - "null"
          format: uuid
          description: User ID of the operator who initiated the promotion.
        promoted_by_username:
          type:
            - string
            - "null"
          description: Username of the operator who initiated the promotion.
        policy_result:
          type:
            - object
            - "null"
          additionalProperties: true
          description: Serialised result of the promotion policy evaluation, null if skipped.
        notes:
          type:
            - string
            - "null"
          description: Free-text notes attached to the promotion.
        created_at:
          type: string
          format: date-time

    # =========================================================================
    # Dependency-Track Schemas
    # =========================================================================

    DtStatusResponse:
      type: object
      required:
        - enabled
        - healthy
      properties:
        enabled:
          type: boolean
          description: Whether the Dependency-Track integration is enabled
        healthy:
          type: boolean
          description: Whether the Dependency-Track instance is reachable and healthy
        url:
          type:
            - string
            - "null"
          description: Base URL of the Dependency-Track instance

    DtProject:
      type: object
      required:
        - uuid
        - name
      properties:
        uuid:
          type: string
          description: Dependency-Track project UUID
        name:
          type: string
          description: Project name
        version:
          type:
            - string
            - "null"
          description: Project version
        description:
          type:
            - string
            - "null"
          description: Project description
        last_bom_import:
          type:
            - integer
            - "null"
          description: Unix timestamp of the last BOM import
        last_bom_import_format:
          type:
            - string
            - "null"
          description: Format of the last imported BOM (e.g. CycloneDX, SPDX)

    DtFinding:
      type: object
      required:
        - component
        - vulnerability
      properties:
        component:
          $ref: "#/components/schemas/DtComponent"
        vulnerability:
          $ref: "#/components/schemas/DtVulnerability"
        analysis:
          oneOf:
            - $ref: "#/components/schemas/DtAnalysis"
            - type: "null"
          description: Analysis state for this finding, if any
        attribution:
          oneOf:
            - $ref: "#/components/schemas/DtAttribution"
            - type: "null"
          description: Attribution information for how this finding was discovered

    DtComponent:
      type: object
      required:
        - uuid
        - name
      properties:
        uuid:
          type: string
          description: Component UUID
        name:
          type: string
          description: Component name
        version:
          type:
            - string
            - "null"
          description: Component version
        group:
          type:
            - string
            - "null"
          description: Component group or namespace
        purl:
          type:
            - string
            - "null"
          description: Package URL (purl) identifier

    DtVulnerability:
      type: object
      required:
        - uuid
        - vuln_id
        - source
        - severity
      properties:
        uuid:
          type: string
          description: Vulnerability UUID
        vuln_id:
          type: string
          description: Vulnerability identifier (e.g. CVE-2024-12345)
        source:
          type: string
          description: Vulnerability data source (e.g. NVD, GITHUB, OSV)
        severity:
          type: string
          description: Severity level (CRITICAL, HIGH, MEDIUM, LOW, INFO, UNASSIGNED)
        title:
          type:
            - string
            - "null"
          description: Short title of the vulnerability
        description:
          type:
            - string
            - "null"
          description: Detailed description of the vulnerability
        cvss_v3_base_score:
          type:
            - number
            - "null"
          description: CVSS v3 base score (0.0 to 10.0)
        cwe:
          oneOf:
            - $ref: "#/components/schemas/DtCwe"
            - type: "null"
          description: Associated CWE classification

    DtCwe:
      type: object
      required:
        - cwe_id
        - name
      properties:
        cwe_id:
          type: integer
          description: CWE identifier number
        name:
          type: string
          description: CWE name

    DtAnalysis:
      type: object
      required:
        - is_suppressed
      properties:
        state:
          type:
            - string
            - "null"
          description: Analysis state (e.g. NOT_SET, EXPLOITABLE, IN_TRIAGE, FALSE_POSITIVE, NOT_AFFECTED)
        justification:
          type:
            - string
            - "null"
          description: Justification for the analysis decision
        response:
          type:
            - string
            - "null"
          description: Response action taken
        details:
          type:
            - string
            - "null"
          description: Additional analysis details
        is_suppressed:
          type: boolean
          description: Whether the finding is suppressed

    DtAttribution:
      type: object
      properties:
        analyzer_identity:
          type:
            - string
            - "null"
          description: Identity of the analyzer that discovered the finding
        attributed_on:
          type:
            - integer
            - "null"
          description: Unix timestamp of when the finding was attributed

    DtComponentFull:
      type: object
      required:
        - uuid
        - name
      properties:
        uuid:
          type: string
          description: Component UUID
        name:
          type: string
          description: Component name
        version:
          type:
            - string
            - "null"
          description: Component version
        group:
          type:
            - string
            - "null"
          description: Component group or namespace
        purl:
          type:
            - string
            - "null"
          description: Package URL (purl) identifier
        cpe:
          type:
            - string
            - "null"
          description: Common Platform Enumeration identifier
        resolved_license:
          oneOf:
            - $ref: "#/components/schemas/DtLicense"
            - type: "null"
          description: Resolved license information for the component
        is_internal:
          type:
            - boolean
            - "null"
          description: Whether the component is an internal dependency

    DtLicense:
      type: object
      required:
        - name
      properties:
        uuid:
          type:
            - string
            - "null"
          description: License UUID
        license_id:
          type:
            - string
            - "null"
          description: SPDX license identifier
        name:
          type: string
          description: License name

    DtProjectMetrics:
      type: object
      required:
        - critical
        - high
        - medium
        - low
        - unassigned
        - findings_total
        - findings_audited
        - findings_unaudited
        - suppressions
        - inherited_risk_score
        - policy_violations_fail
        - policy_violations_warn
        - policy_violations_info
        - policy_violations_total
      properties:
        critical:
          type: integer
          description: Number of critical severity vulnerabilities
        high:
          type: integer
          description: Number of high severity vulnerabilities
        medium:
          type: integer
          description: Number of medium severity vulnerabilities
        low:
          type: integer
          description: Number of low severity vulnerabilities
        unassigned:
          type: integer
          description: Number of unassigned severity vulnerabilities
        vulnerabilities:
          type:
            - integer
            - "null"
          description: Total number of unique vulnerabilities
        findings_total:
          type: integer
          description: Total number of findings
        findings_audited:
          type: integer
          description: Number of audited findings
        findings_unaudited:
          type: integer
          description: Number of unaudited findings
        suppressions:
          type: integer
          description: Number of suppressed findings
        inherited_risk_score:
          type: number
          description: Calculated inherited risk score
        policy_violations_fail:
          type: integer
          description: Number of policy violations with fail state
        policy_violations_warn:
          type: integer
          description: Number of policy violations with warn state
        policy_violations_info:
          type: integer
          description: Number of policy violations with info state
        policy_violations_total:
          type: integer
          description: Total number of policy violations
        first_occurrence:
          type:
            - integer
            - "null"
          description: Unix timestamp of the earliest metric occurrence
        last_occurrence:
          type:
            - integer
            - "null"
          description: Unix timestamp of the most recent metric occurrence

    DtPortfolioMetrics:
      allOf:
        - $ref: "#/components/schemas/DtProjectMetrics"
        - type: object
          required:
            - projects
          properties:
            projects:
              type: integer
              description: Total number of projects in the portfolio

    DtPolicyViolation:
      type: object
      required:
        - uuid
        - type
        - component
        - policyCondition
      properties:
        uuid:
          type: string
          description: Policy violation UUID
        type:
          type: string
          description: Violation type (e.g. LICENSE, SECURITY, OPERATIONAL)
        component:
          $ref: "#/components/schemas/DtComponent"
        policyCondition:
          $ref: "#/components/schemas/DtPolicyCondition"

    DtPolicyCondition:
      type: object
      required:
        - uuid
        - subject
        - operator
        - value
        - policy
      properties:
        uuid:
          type: string
          description: Policy condition UUID
        subject:
          type: string
          description: Condition subject (e.g. AGE, COORDINATES, LICENSE, SEVERITY)
        operator:
          type: string
          description: Condition operator (e.g. IS, IS_NOT, MATCHES, CONTAINS)
        value:
          type: string
          description: Condition value to evaluate against
        policy:
          $ref: "#/components/schemas/DtPolicy"

    DtPolicy:
      type: object
      required:
        - uuid
        - name
        - violation_state
      properties:
        uuid:
          type: string
          description: Policy UUID
        name:
          type: string
          description: Policy name
        violation_state:
          type: string
          description: Violation state (e.g. FAIL, WARN, INFO)

    DtAnalysisResponse:
      type: object
      required:
        - analysis_state
        - is_suppressed
      properties:
        analysis_state:
          type: string
          description: Updated analysis state
        analysis_justification:
          type:
            - string
            - "null"
          description: Updated analysis justification
        analysis_details:
          type:
            - string
            - "null"
          description: Updated analysis details
        is_suppressed:
          type: boolean
          description: Whether the finding is suppressed

    DtPolicyFull:
      type: object
      required:
        - uuid
        - name
        - violation_state
        - policy_conditions
        - projects
        - tags
      properties:
        uuid:
          type: string
          description: Policy UUID
        name:
          type: string
          description: Policy name
        violation_state:
          type: string
          description: Violation state (e.g. FAIL, WARN, INFO)
        include_children:
          type:
            - boolean
            - "null"
          description: Whether the policy applies to child projects
        policy_conditions:
          type: array
          items:
            $ref: "#/components/schemas/DtPolicyConditionFull"
          description: Conditions that trigger this policy
        projects:
          type: array
          items:
            $ref: "#/components/schemas/DtProject"
          description: Projects this policy is applied to
        tags:
          type: array
          items:
            type: object
          description: Tags associated with this policy

    DtPolicyConditionFull:
      type: object
      required:
        - uuid
        - subject
        - operator
        - value
      properties:
        uuid:
          type: string
          description: Policy condition UUID
        subject:
          type: string
          description: Condition subject (e.g. AGE, COORDINATES, LICENSE, SEVERITY)
        operator:
          type: string
          description: Condition operator (e.g. IS, IS_NOT, MATCHES, CONTAINS)
        value:
          type: string
          description: Condition value to evaluate against

    # =========================================================================
    # TOTP Schemas
    # =========================================================================

    TotpSetupResponse:
      type: object
      required:
        - secret
        - qr_code_url
      properties:
        secret:
          type: string
          description: Base32-encoded TOTP secret for manual entry
        qr_code_url:
          type: string
          description: otpauth:// URI for QR code generation

    TotpEnableResponse:
      type: object
      required:
        - backup_codes
      properties:
        backup_codes:
          type: array
          items:
            type: string
          description: One-time backup codes for account recovery if the authenticator is unavailable

    # =========================================================================
    # SSO Schemas
    # =========================================================================

    OidcConfigResponse:
      type: object
      required:
        - id
        - name
        - issuer_url
        - client_id
        - has_secret
        - scopes
        - attribute_mapping
        - is_enabled
        - auto_create_users
        - created_at
        - updated_at
      properties:
        id:
          type: string
          format: uuid
          description: OIDC configuration UUID
        name:
          type: string
          description: Display name for the OIDC provider
        issuer_url:
          type: string
          description: OIDC issuer URL for discovery
        client_id:
          type: string
          description: OAuth2 client identifier
        has_secret:
          type: boolean
          description: Whether a client secret has been configured
        scopes:
          type: array
          items:
            type: string
          description: OAuth2 scopes to request
        attribute_mapping:
          type: object
          description: Mapping of OIDC claims to user attributes
        is_enabled:
          type: boolean
          description: Whether this OIDC configuration is active
        auto_create_users:
          type: boolean
          description: Whether to automatically create user accounts on first login
        created_at:
          type: string
          format: date-time
          description: Timestamp when the configuration was created
        updated_at:
          type: string
          format: date-time
          description: Timestamp when the configuration was last modified

    CreateOidcConfigRequest:
      type: object
      required:
        - name
        - issuer_url
        - client_id
        - client_secret
      properties:
        name:
          type: string
          description: Display name for the OIDC provider
          minLength: 1
        issuer_url:
          type: string
          description: OIDC issuer URL for discovery
          minLength: 1
        client_id:
          type: string
          description: OAuth2 client identifier
          minLength: 1
        client_secret:
          type: string
          description: OAuth2 client secret
          minLength: 1
        scopes:
          type: array
          items:
            type: string
          description: OAuth2 scopes to request (defaults to openid, profile, email)
        attribute_mapping:
          type: object
          description: Mapping of OIDC claims to user attributes
        is_enabled:
          type: boolean
          description: Whether to enable the configuration immediately
          default: false
        auto_create_users:
          type: boolean
          description: Whether to automatically create user accounts on first login
          default: true

    UpdateOidcConfigRequest:
      type: object
      properties:
        name:
          type: string
          description: Display name for the OIDC provider
          minLength: 1
        issuer_url:
          type: string
          description: OIDC issuer URL for discovery
          minLength: 1
        client_id:
          type: string
          description: OAuth2 client identifier
          minLength: 1
        client_secret:
          type: string
          description: OAuth2 client secret (omit to keep existing)
        scopes:
          type: array
          items:
            type: string
          description: OAuth2 scopes to request
        attribute_mapping:
          type: object
          description: Mapping of OIDC claims to user attributes
        is_enabled:
          type: boolean
          description: Whether the OIDC configuration is active
        auto_create_users:
          type: boolean
          description: Whether to automatically create user accounts on first login

    LdapConfigResponse:
      type: object
      required:
        - id
        - name
        - server_url
        - has_bind_password
        - user_base_dn
        - user_filter
        - email_attribute
        - display_name_attribute
        - username_attribute
        - groups_attribute
        - use_starttls
        - is_enabled
        - created_at
        - updated_at
      properties:
        id:
          type: string
          format: uuid
          description: LDAP configuration UUID
        name:
          type: string
          description: Display name for the LDAP provider
        server_url:
          type: string
          description: LDAP server URL (ldap:// or ldaps://)
        bind_dn:
          type:
            - string
            - "null"
          description: Distinguished name used for binding to the LDAP server
        has_bind_password:
          type: boolean
          description: Whether a bind password has been configured
        user_base_dn:
          type: string
          description: Base DN for user searches
        user_filter:
          type: string
          description: LDAP filter for user lookups
        group_base_dn:
          type:
            - string
            - "null"
          description: Base DN for group searches
        group_filter:
          type:
            - string
            - "null"
          description: LDAP filter for group lookups
        email_attribute:
          type: string
          description: LDAP attribute containing the user email
        display_name_attribute:
          type: string
          description: LDAP attribute containing the user display name
        username_attribute:
          type: string
          description: LDAP attribute containing the username
        groups_attribute:
          type: string
          description: LDAP attribute containing group membership
        admin_group_dn:
          type:
            - string
            - "null"
          description: DN of the group whose members are granted admin privileges
        use_starttls:
          type: boolean
          description: Whether to use STARTTLS for the LDAP connection
        is_enabled:
          type: boolean
          description: Whether this LDAP configuration is active
        created_at:
          type: string
          format: date-time
          description: Timestamp when the configuration was created
        updated_at:
          type: string
          format: date-time
          description: Timestamp when the configuration was last modified

    CreateLdapConfigRequest:
      type: object
      required:
        - name
        - server_url
        - user_base_dn
        - user_filter
        - email_attribute
        - display_name_attribute
        - username_attribute
        - groups_attribute
      properties:
        name:
          type: string
          description: Display name for the LDAP provider
          minLength: 1
        server_url:
          type: string
          description: LDAP server URL (ldap:// or ldaps://)
          minLength: 1
        bind_dn:
          type: string
          description: Distinguished name used for binding to the LDAP server
        bind_password:
          type: string
          description: Password for the bind DN
        user_base_dn:
          type: string
          description: Base DN for user searches
          minLength: 1
        user_filter:
          type: string
          description: LDAP filter for user lookups
          minLength: 1
        group_base_dn:
          type: string
          description: Base DN for group searches
        group_filter:
          type: string
          description: LDAP filter for group lookups
        email_attribute:
          type: string
          description: LDAP attribute containing the user email
          minLength: 1
        display_name_attribute:
          type: string
          description: LDAP attribute containing the user display name
          minLength: 1
        username_attribute:
          type: string
          description: LDAP attribute containing the username
          minLength: 1
        groups_attribute:
          type: string
          description: LDAP attribute containing group membership
          minLength: 1
        admin_group_dn:
          type: string
          description: DN of the group whose members are granted admin privileges
        use_starttls:
          type: boolean
          description: Whether to use STARTTLS for the LDAP connection
          default: false
        is_enabled:
          type: boolean
          description: Whether to enable the configuration immediately
          default: false

    UpdateLdapConfigRequest:
      type: object
      properties:
        name:
          type: string
          description: Display name for the LDAP provider
          minLength: 1
        server_url:
          type: string
          description: LDAP server URL (ldap:// or ldaps://)
          minLength: 1
        bind_dn:
          type: string
          description: Distinguished name used for binding to the LDAP server
        bind_password:
          type: string
          description: Password for the bind DN (omit to keep existing)
        user_base_dn:
          type: string
          description: Base DN for user searches
          minLength: 1
        user_filter:
          type: string
          description: LDAP filter for user lookups
          minLength: 1
        group_base_dn:
          type: string
          description: Base DN for group searches
        group_filter:
          type: string
          description: LDAP filter for group lookups
        email_attribute:
          type: string
          description: LDAP attribute containing the user email
          minLength: 1
        display_name_attribute:
          type: string
          description: LDAP attribute containing the user display name
          minLength: 1
        username_attribute:
          type: string
          description: LDAP attribute containing the username
          minLength: 1
        groups_attribute:
          type: string
          description: LDAP attribute containing group membership
          minLength: 1
        admin_group_dn:
          type: string
          description: DN of the group whose members are granted admin privileges
        use_starttls:
          type: boolean
          description: Whether to use STARTTLS for the LDAP connection
        is_enabled:
          type: boolean
          description: Whether the LDAP configuration is active

    SamlConfigResponse:
      type: object
      required:
        - id
        - name
        - entity_id
        - sso_url
        - has_certificate
        - name_id_format
        - attribute_mapping
        - sp_entity_id
        - sign_requests
        - require_signed_assertions
        - is_enabled
        - created_at
        - updated_at
      properties:
        id:
          type: string
          format: uuid
          description: SAML configuration UUID
        name:
          type: string
          description: Display name for the SAML provider
        entity_id:
          type: string
          description: Identity provider entity ID
        sso_url:
          type: string
          description: Identity provider SSO endpoint URL
        slo_url:
          type:
            - string
            - "null"
          description: Identity provider single logout endpoint URL
        has_certificate:
          type: boolean
          description: Whether an IdP signing certificate has been configured
        name_id_format:
          type: string
          description: SAML NameID format (e.g. urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress)
        attribute_mapping:
          type: object
          description: Mapping of SAML attributes to user properties
        sp_entity_id:
          type: string
          description: Service provider entity ID
        sign_requests:
          type: boolean
          description: Whether to sign SAML authentication requests
        require_signed_assertions:
          type: boolean
          description: Whether to require signed SAML assertions from the IdP
        admin_group:
          type:
            - string
            - "null"
          description: SAML group value that grants admin privileges
        is_enabled:
          type: boolean
          description: Whether this SAML configuration is active
        created_at:
          type: string
          format: date-time
          description: Timestamp when the configuration was created
        updated_at:
          type: string
          format: date-time
          description: Timestamp when the configuration was last modified

    CreateSamlConfigRequest:
      type: object
      required:
        - name
        - entity_id
        - sso_url
        - certificate
        - sp_entity_id
      properties:
        name:
          type: string
          description: Display name for the SAML provider
          minLength: 1
        entity_id:
          type: string
          description: Identity provider entity ID
          minLength: 1
        sso_url:
          type: string
          description: Identity provider SSO endpoint URL
          minLength: 1
        slo_url:
          type: string
          description: Identity provider single logout endpoint URL
        certificate:
          type: string
          description: PEM-encoded IdP signing certificate
          minLength: 1
        name_id_format:
          type: string
          description: SAML NameID format
          default: "urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress"
        attribute_mapping:
          type: object
          description: Mapping of SAML attributes to user properties
        sp_entity_id:
          type: string
          description: Service provider entity ID
          minLength: 1
        sign_requests:
          type: boolean
          description: Whether to sign SAML authentication requests
          default: false
        require_signed_assertions:
          type: boolean
          description: Whether to require signed SAML assertions from the IdP
          default: true
        admin_group:
          type: string
          description: SAML group value that grants admin privileges
        is_enabled:
          type: boolean
          description: Whether to enable the configuration immediately
          default: false

    UpdateSamlConfigRequest:
      type: object
      properties:
        name:
          type: string
          description: Display name for the SAML provider
          minLength: 1
        entity_id:
          type: string
          description: Identity provider entity ID
          minLength: 1
        sso_url:
          type: string
          description: Identity provider SSO endpoint URL
          minLength: 1
        slo_url:
          type: string
          description: Identity provider single logout endpoint URL
        certificate:
          type: string
          description: PEM-encoded IdP signing certificate (omit to keep existing)
        name_id_format:
          type: string
          description: SAML NameID format
        attribute_mapping:
          type: object
          description: Mapping of SAML attributes to user properties
        sp_entity_id:
          type: string
          description: Service provider entity ID
          minLength: 1
        sign_requests:
          type: boolean
          description: Whether to sign SAML authentication requests
        require_signed_assertions:
          type: boolean
          description: Whether to require signed SAML assertions from the IdP
        admin_group:
          type: string
          description: SAML group value that grants admin privileges
        is_enabled:
          type: boolean
          description: Whether the SAML configuration is active

    LdapTestResult:
      type: object
      required:
        - success
        - message
        - response_time_ms
      properties:
        success:
          type: boolean
          description: Whether the LDAP connectivity test succeeded
        message:
          type: string
          description: Human-readable result message
        response_time_ms:
          type: integer
          description: Time taken for the LDAP operation in milliseconds

    SsoProviderInfo:
      type: object
      required:
        - id
        - name
        - provider_type
        - login_url
      properties:
        id:
          type: string
          format: uuid
          description: SSO provider configuration UUID
        name:
          type: string
          description: Display name of the SSO provider
        provider_type:
          type: string
          description: Provider type (oidc, ldap, saml)
        login_url:
          type: string
          description: URL to initiate the SSO login flow

    SsoExchangeResponse:
      type: object
      required:
        - access_token
        - refresh_token
        - token_type
      properties:
        access_token:
          type: string
          description: JWT access token
        refresh_token:
          type: string
          description: Refresh token for obtaining new access tokens
        token_type:
          type: string
          enum: [Bearer]
          description: Token type (always Bearer)

    # -----------------------------------------------------------------------
    # Analytics schemas
    # -----------------------------------------------------------------------

    StorageSnapshot:
      type: object
      description: A point-in-time snapshot of aggregate system metrics.
      required:
        - snapshot_date
        - total_repositories
        - total_artifacts
        - total_storage_bytes
        - total_downloads
        - total_users
      properties:
        snapshot_date:
          type: string
          format: date
          description: The date this snapshot was captured (YYYY-MM-DD).
          example: "2026-02-07"
        total_repositories:
          type: integer
          description: Total number of repositories at the time of the snapshot.
          example: 42
        total_artifacts:
          type: integer
          description: Total number of artifacts across all repositories.
          example: 18340
        total_storage_bytes:
          type: integer
          format: int64
          description: Total storage consumed in bytes.
          example: 53687091200
        total_downloads:
          type: integer
          format: int64
          description: Cumulative download count at the time of the snapshot.
          example: 1250000
        total_users:
          type: integer
          description: Total number of registered users.
          example: 215

    RepositoryStorageBreakdown:
      type: object
      description: Storage usage breakdown for a single repository.
      required:
        - repository_id
        - repository_key
        - repository_name
        - format
        - artifact_count
        - storage_bytes
        - download_count
      properties:
        repository_id:
          type: string
          format: uuid
          description: Unique identifier of the repository.
        repository_key:
          type: string
          description: URL-safe key of the repository.
          example: libs-release-local
        repository_name:
          type: string
          description: Human-readable name of the repository.
          example: Release Libraries
        format:
          type: string
          description: Package format handled by this repository.
          example: maven
        artifact_count:
          type: integer
          description: Number of artifacts stored in this repository.
          example: 4820
        storage_bytes:
          type: integer
          format: int64
          description: Total storage consumed by this repository in bytes.
          example: 10737418240
        download_count:
          type: integer
          format: int64
          description: Total download count for artifacts in this repository.
          example: 340000
        last_upload_at:
          type: [string, "null"]
          format: date-time
          description: Timestamp of the most recent artifact upload, or null if no artifacts have been uploaded.
          example: "2026-02-07T09:14:22Z"

    GrowthSummary:
      type: object
      description: Aggregate growth metrics comparing the start and end of a time period.
      required:
        - period_start
        - period_end
        - storage_bytes_start
        - storage_bytes_end
        - storage_growth_bytes
        - storage_growth_percent
        - artifacts_start
        - artifacts_end
        - artifacts_added
        - downloads_in_period
      properties:
        period_start:
          type: string
          format: date
          description: First date of the comparison period.
          example: "2026-01-08"
        period_end:
          type: string
          format: date
          description: Last date of the comparison period.
          example: "2026-02-07"
        storage_bytes_start:
          type: integer
          format: int64
          description: Storage consumed at the start of the period in bytes.
          example: 48318382080
        storage_bytes_end:
          type: integer
          format: int64
          description: Storage consumed at the end of the period in bytes.
          example: 53687091200
        storage_growth_bytes:
          type: integer
          format: int64
          description: Net change in storage bytes over the period.
          example: 5368709120
        storage_growth_percent:
          type: number
          format: double
          description: Percentage growth in storage over the period.
          example: 11.1
        artifacts_start:
          type: integer
          description: Total artifact count at the start of the period.
          example: 16200
        artifacts_end:
          type: integer
          description: Total artifact count at the end of the period.
          example: 18340
        artifacts_added:
          type: integer
          description: Net number of artifacts added during the period.
          example: 2140
        downloads_in_period:
          type: integer
          format: int64
          description: Total downloads that occurred within the period.
          example: 87500

    StaleArtifact:
      type: object
      description: An artifact that has not been downloaded within the staleness threshold.
      required:
        - artifact_id
        - repository_key
        - name
        - path
        - size_bytes
        - created_at
        - days_since_download
        - download_count
      properties:
        artifact_id:
          type: string
          format: uuid
          description: Unique identifier of the artifact.
        repository_key:
          type: string
          description: Key of the repository containing the artifact.
          example: libs-release-local
        name:
          type: string
          description: Artifact file name.
          example: commons-lang3-3.12.0.jar
        path:
          type: string
          description: Full path within the repository.
          example: org/apache/commons/commons-lang3/3.12.0/commons-lang3-3.12.0.jar
        size_bytes:
          type: integer
          format: int64
          description: Size of the artifact in bytes.
          example: 614400
        created_at:
          type: string
          format: date-time
          description: Timestamp when the artifact was first uploaded.
          example: "2025-04-15T10:30:00Z"
        last_downloaded_at:
          type: [string, "null"]
          format: date-time
          description: Timestamp of the most recent download, or null if the artifact has never been downloaded.
          example: "2025-10-01T14:22:00Z"
        days_since_download:
          type: integer
          description: Number of days since the artifact was last downloaded. If never downloaded, this reflects days since creation.
          example: 129
        download_count:
          type: integer
          format: int64
          description: Total number of times this artifact has been downloaded.
          example: 3

    DownloadTrend:
      type: object
      description: Download count for a single day.
      required:
        - date
        - download_count
      properties:
        date:
          type: string
          format: date
          description: The date of the data point (YYYY-MM-DD).
          example: "2026-02-07"
        download_count:
          type: integer
          format: int64
          description: Number of downloads on this date.
          example: 4200

    RepositorySnapshot:
      type: object
      description: A point-in-time snapshot of metrics for a single repository.
      required:
        - repository_id
        - snapshot_date
        - artifact_count
        - storage_bytes
        - download_count
      properties:
        repository_id:
          type: string
          format: uuid
          description: Unique identifier of the repository.
        repository_name:
          type: [string, "null"]
          description: Human-readable name of the repository, or null if the repository has been deleted.
          example: Release Libraries
        repository_key:
          type: [string, "null"]
          description: URL-safe key of the repository, or null if the repository has been deleted.
          example: libs-release-local
        snapshot_date:
          type: string
          format: date
          description: The date this snapshot was captured (YYYY-MM-DD).
          example: "2026-02-07"
        artifact_count:
          type: integer
          description: Number of artifacts in the repository at the time of the snapshot.
          example: 4820
        storage_bytes:
          type: integer
          format: int64
          description: Storage consumed by the repository in bytes.
          example: 10737418240
        download_count:
          type: integer
          format: int64
          description: Cumulative download count for the repository.
          example: 340000

    # -----------------------------------------------------------------------
    # Monitoring schemas
    # -----------------------------------------------------------------------

    ServiceHealthEntry:
      type: object
      description: A single health check result recorded for a monitored service.
      required:
        - service_name
        - status
        - checked_at
      properties:
        service_name:
          type: string
          description: Name of the monitored service.
          example: database
        status:
          type: string
          description: Health status determined by the check.
          enum: [healthy, degraded, unhealthy]
          example: healthy
        previous_status:
          type: [string, "null"]
          description: Status from the preceding check, or null if this is the first recorded check.
          enum: [healthy, degraded, unhealthy, null]
          example: healthy
        message:
          type: [string, "null"]
          description: Human-readable diagnostic message, typically populated on degraded or unhealthy checks.
          example: "Connection pool exhausted"
        response_time_ms:
          type: [integer, "null"]
          description: Time taken to complete the health probe in milliseconds, or null if the probe timed out.
          example: 12
        checked_at:
          type: string
          format: date-time
          description: Timestamp when the health check was performed.
          example: "2026-02-07T14:30:00Z"

    AlertState:
      type: object
      description: Current alert state for a monitored service.
      required:
        - service_name
        - current_status
        - consecutive_failures
        - updated_at
      properties:
        service_name:
          type: string
          description: Name of the monitored service.
          example: database
        current_status:
          type: string
          description: Most recent health status.
          enum: [healthy, degraded, unhealthy]
          example: healthy
        consecutive_failures:
          type: integer
          description: Number of consecutive health check failures. Resets to zero on a successful check.
          example: 0
        last_alert_sent_at:
          type: [string, "null"]
          format: date-time
          description: Timestamp of the most recent alert notification, or null if no alert has been sent.
          example: "2026-02-06T08:15:00Z"
        suppressed_until:
          type: [string, "null"]
          format: date-time
          description: If set, alert notifications are suppressed until this timestamp.
          example: "2026-02-08T12:00:00Z"
        updated_at:
          type: string
          format: date-time
          description: Timestamp of the most recent state change.
          example: "2026-02-07T14:30:00Z"

    TelemetrySettings:
      type: object
      description: Configuration for the telemetry data collection subsystem.
      required:
        - enabled
        - review_before_send
        - scrub_level
        - include_logs
      properties:
        enabled:
          type: boolean
          description: Whether telemetry data collection is active.
        review_before_send:
          type: boolean
          description: When true, crash reports must be reviewed by an admin before submission.
        scrub_level:
          type: string
          description: Level of personally identifiable information scrubbing applied to telemetry data (e.g. none, basic, aggressive).
        include_logs:
          type: boolean
          description: Whether application log snippets are included in telemetry payloads.

    CrashReport:
      type: object
      description: A recorded application crash event with diagnostic information.
      required:
        - id
        - error_type
        - error_message
        - component
        - severity
        - app_version
        - context
        - submitted
        - error_signature
        - occurrence_count
        - first_seen_at
        - last_seen_at
        - created_at
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier for the crash report.
        error_type:
          type: string
          description: Classification of the error (e.g. panic, segfault, oom).
        error_message:
          type: string
          description: Human-readable error message captured at crash time.
        stack_trace:
          type: [string, "null"]
          description: Full stack trace captured at the point of failure.
        component:
          type: string
          description: Application component or subsystem where the crash originated.
        severity:
          type: string
          description: Severity level of the crash (e.g. critical, error, warning).
        app_version:
          type: string
          description: Application version string at the time of the crash.
        os_info:
          type: [string, "null"]
          description: Operating system and platform information.
        uptime_seconds:
          type: [integer, "null"]
          description: Application uptime in seconds before the crash occurred.
        context:
          type: object
          description: Arbitrary key-value metadata providing additional crash context.
        submitted:
          type: boolean
          description: Whether this crash report has been submitted to the telemetry service.
        submitted_at:
          type: [string, "null"]
          format: date-time
          description: Timestamp when the crash report was submitted.
        submission_error:
          type: [string, "null"]
          description: Error message if the most recent submission attempt failed.
        error_signature:
          type: string
          description: Deduplicated signature derived from the error type and stack trace.
        occurrence_count:
          type: integer
          description: Number of times this crash (by signature) has been observed.
        first_seen_at:
          type: string
          format: date-time
          description: Timestamp of the first occurrence of this crash signature.
        last_seen_at:
          type: string
          format: date-time
          description: Timestamp of the most recent occurrence of this crash signature.
        created_at:
          type: string
          format: date-time
          description: Timestamp when this crash report record was created.

    CrashListResponse:
      type: object
      description: Paginated response containing crash reports.
      required:
        - items
        - total
      properties:
        items:
          type: array
          description: List of crash reports for the current page.
          items:
            $ref: "#/components/schemas/CrashReport"
        total:
          type: integer
          description: Total number of crash reports matching the query.

    LifecyclePolicy:
      type: object
      description: An automated policy governing artifact retention and cleanup.
      required:
        - id
        - name
        - enabled
        - policy_type
        - config
        - priority
        - created_at
        - updated_at
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier for the lifecycle policy.
        repository_id:
          type: [string, "null"]
          format: uuid
          description: Repository this policy is scoped to. Null indicates a global policy.
        name:
          type: string
          description: Human-readable name for the policy.
        description:
          type: [string, "null"]
          description: Longer description of the policy purpose and behavior.
        enabled:
          type: boolean
          description: Whether the policy is active for scheduled execution.
        policy_type:
          type: string
          description: Type of lifecycle policy (e.g. retention, cleanup, archive).
        config:
          type: object
          description: Policy-type-specific configuration object.
        priority:
          type: integer
          description: Execution priority. Lower values execute first.
        last_run_at:
          type: [string, "null"]
          format: date-time
          description: Timestamp of the most recent policy execution.
        last_run_items_removed:
          type: [integer, "null"]
          description: Number of artifacts removed during the most recent execution.
        created_at:
          type: string
          format: date-time
          description: Timestamp when the policy was created.
        updated_at:
          type: string
          format: date-time
          description: Timestamp when the policy was last modified.

    PolicyExecutionResult:
      type: object
      description: Outcome of a lifecycle policy execution or dry-run preview.
      required:
        - policy_id
        - policy_name
        - dry_run
        - artifacts_matched
        - artifacts_removed
        - bytes_freed
        - errors
      properties:
        policy_id:
          type: string
          format: uuid
          description: Identifier of the executed lifecycle policy.
        policy_name:
          type: string
          description: Name of the executed lifecycle policy.
        dry_run:
          type: boolean
          description: Whether this was a preview (true) or a real execution (false).
        artifacts_matched:
          type: integer
          description: Number of artifacts that matched the policy criteria.
        artifacts_removed:
          type: integer
          description: Number of artifacts actually removed. Zero for dry-run previews.
        bytes_freed:
          type: integer
          description: Total storage bytes reclaimed by the execution. Zero for dry-run previews.
        errors:
          type: array
          description: List of errors encountered during execution.
          items:
            type: string
